{
"code":"@Override\npublic boolean onTouchEvent(TextView widget, Spannable buffer, MotionEvent event) {\n    int action = event.getAction();\n\n    if (action == MotionEvent.ACTION_UP || action == MotionEvent.ACTION_DOWN) {\n        int x = (int) event.getX();\n        int y = (int) event.getY();\n\n        x -= widget.getTotalPaddingLeft();\n        y -= widget.getTotalPaddingTop();\n\n        x += widget.getScrollX();\n        y += widget.getScrollY();\n\n        Layout layout = widget.getLayout();\n        int line = layout.getLineForVertical(y);\n        int off = layout.getOffsetForHorizontal(line, x);\n\n        ClickableSpan[] link = buffer.getSpans(off, off, ClickableSpan.class);\n\n        if (link.length != 0) {\n            if (action == MotionEvent.ACTION_UP) {\n                link[0].onClick(widget);\n            } else if (action == MotionEvent.ACTION_DOWN) {\n                Selection.setSelection(buffer,\n                        buffer.getSpanStart(link[0]),\n                        buffer.getSpanEnd(link[0]));\n            }\n\n            if (widget instanceof org.sufficientlysecure.htmltextview.HtmlTextView) {\n                ((org.sufficientlysecure.htmltextview.HtmlTextView) widget).linkHit = true;\n            }\n            return true;\n        } else {\n            Selection.removeSelection(buffer);\n            Touch.onTouchEvent(widget, buffer, event);\n            return false;\n        }\n    }\n    return Touch.onTouchEvent(widget, buffer, event);\n}",
"explanation":"code_hardening: none\nresolve_compilation_errors: Updated the type check and cast to use org.sufficientlysecure.htmltextview.HtmlTextView and referenced it with a fully qualified name to avoid import issues; assumed the HtmlTextView class defines a compatible linkHit field as intended.\nexception_handling: none\nlogic_customization: Replaced the instanceof TextViewFixTouchConsume check with instanceof HtmlTextView and set linkHit = true on the HtmlTextView instance while preserving all other touch-handling logic and control flow unchanged.\nrefactoring: none\nmisc: none"
}