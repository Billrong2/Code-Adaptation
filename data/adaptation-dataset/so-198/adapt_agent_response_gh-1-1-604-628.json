{
  "code": "public static void positionToast(final Toast toast, final View view, final Window window, final int offsetX, final int offsetY) {\n\t// Defensive checks to avoid NPEs\n\tif (toast == null || view == null || window == null || toast.getView() == null) {\n\t\treturn;\n\t}\n\n\t// Toasts are positioned relative to the decor view; views are relative to their parents.\n\t// Gather data to convert everything into the same (decor-view-relative) coordinate system.\n\tfinal Rect visibleFrame = new Rect();\n\twindow.getDecorView().getWindowVisibleDisplayFrame(visibleFrame);\n\n\t// Convert anchor view absolute position to decor-view-relative position\n\tfinal int[] viewLocation = new int[2];\n\tview.getLocationInWindow(viewLocation);\n\tfinal int viewLeft = viewLocation[0] - visibleFrame.left;\n\tfinal int viewTop = viewLocation[1] - visibleFrame.top;\n\n\t// Measure toast to determine its dimensions\n\tfinal DisplayMetrics metrics = new DisplayMetrics();\n\twindow.getWindowManager().getDefaultDisplay().getMetrics(metrics);\n\tfinal int widthMeasureSpec = View.MeasureSpec.makeMeasureSpec(metrics.widthPixels, View.MeasureSpec.UNSPECIFIED);\n\tfinal int heightMeasureSpec = View.MeasureSpec.makeMeasureSpec(metrics.heightPixels, View.MeasureSpec.UNSPECIFIED);\n\ttoast.getView().measure(widthMeasureSpec, heightMeasureSpec);\n\tfinal int toastWidth = toast.getView().getMeasuredWidth();\n\n\t// Compute anchor horizontal center\n\tfinal int anchorCenterX = viewLeft + view.getWidth() / 2;\n\n\t// Position toast so its right edge aligns with the anchor view's horizontal center\n\tfinal int toastX = anchorCenterX - toastWidth + offsetX;\n\n\t// Keep vertical positioning unchanged: below the anchor view plus offset\n\tfinal int toastY = viewTop + view.getHeight() + offsetY;\n\n\t// Apply gravity and offsets\n\ttoast.setGravity(Gravity.LEFT | Gravity.TOP, toastX, toastY);\n}",
  "explanation": "code_hardening: Added null checks for toast, view, window, and toast.getView() to prevent NullPointerException, and marked parameters as final for clarity.\nresolve_compilation_errors: Replaced unqualified MeasureSpec usage with View.MeasureSpec to ensure correct namespace resolution and avoid compilation issues.\nexception_handling: none\nlogic_customization: Changed the horizontal positioning logic so the toast’s right edge aligns with the anchor view’s horizontal center (anchorCenterX - toastWidth), while preserving decor-view-relative coordinate conversion, vertical positioning, and Gravity.LEFT | Gravity.TOP.\nrefactoring: Introduced clearer variable names such as visibleFrame and anchorCenterX to improve readability without altering behavior.\nmisc: Updated comments to document the new right-edge alignment behavior; no new custom API calls were introduced."
}