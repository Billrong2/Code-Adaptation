{
  "code": "public Intent createEmailOnlyChooserIntent(Intent source, CharSequence chooserTitle) {\n        // Adapted from a Stack Overflow answer: create an email-only chooser intent\n        if (source == null) {\n            return null;\n        }\n\n        final CharSequence safeTitle = (chooserTitle != null) ? chooserTitle : \"\";\n        final java.util.ArrayList<Intent> emailIntents = new java.util.ArrayList<Intent>();\n\n        android.content.pm.PackageManager pm = null;\n        if (getActivity() != null) {\n            pm = getActivity().getPackageManager();\n        }\n\n        if (pm != null) {\n            try {\n                Intent probe = new Intent(Intent.ACTION_SENDTO, android.net.Uri.fromParts(\"mailto\", \"\", null));\n                java.util.List<android.content.pm.ResolveInfo> activities = pm.queryIntentActivities(probe, 0);\n\n                if (activities != null) {\n                    for (android.content.pm.ResolveInfo ri : activities) {\n                        if (ri == null || ri.activityInfo == null || ri.activityInfo.packageName == null || ri.activityInfo.packageName.length() == 0) {\n                            continue;\n                        }\n                        Intent target = new Intent(source);\n                        target.setPackage(ri.activityInfo.packageName);\n                        emailIntents.add(target);\n                    }\n                }\n            } catch (SecurityException se) {\n                // ignore and fallback to default chooser\n            } catch (RuntimeException re) {\n                // ignore and fallback to default chooser\n            }\n        }\n\n        if (!emailIntents.isEmpty()) {\n            Intent chooserIntent = Intent.createChooser(emailIntents.remove(0), safeTitle);\n            chooserIntent.putExtra(Intent.EXTRA_INITIAL_INTENTS,\n                    emailIntents.toArray(new android.os.Parcelable[emailIntents.size()]));\n            return chooserIntent;\n        }\n\n        return Intent.createChooser(source, safeTitle);\n    }",
  "explanation": "code_hardening: Added null checks for source, chooserTitle, PackageManager, activities list, ResolveInfo, activityInfo, and packageName; safely handle cases where no email apps are available and fall back to a default chooser; replaced Stack usage with ArrayList to avoid LIFO semantics.\nresolve_compilation_errors: Replaced direct getPackageManager() usage with getActivity().getPackageManager(); used fully qualified class names (Intent, Uri, ResolveInfo, Parcelable, PackageManager) to avoid missing imports; kept the existing method signature consistent with its callers in SettingsFragment.\nexception_handling: Wrapped queryIntentActivities in try-catch blocks to handle SecurityException and generic RuntimeException, falling back gracefully without crashing.\nlogic_customization: Used ACTION_SENDTO with an empty mailto: URI to filter only email-capable apps while preserving the caller-provided source intent (extras like recipient, subject, body); ensured behavior aligns with onClick/onPreferenceChange callers that immediately start the returned chooser.\nrefactoring: Renamed local variables for clarity (intents -> emailIntents, i -> probe); simplified flow and reduced nesting while keeping logic within a single function.\nmisc: Added a header comment attributing the method to a Stack Overflow source; minimal formatting consistent with existing code style; no new custom API calls introduced beyond existing Android framework usage."
}