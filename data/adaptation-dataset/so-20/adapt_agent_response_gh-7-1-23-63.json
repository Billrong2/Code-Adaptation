{
  "code": "/**\n     * Returns a set of the unique names of all query parameters. Iterating\n     * over the set will return the names in order of their first occurrence.\n     * <p>\n     * Extracted from {@link android.net.Uri#getQueryParameterNames()} for\n     * compatibility with older API levels.\n     *\n     * @throws UnsupportedOperationException if this isn't a hierarchical URI\n     * @throws NullPointerException if {@code uri} is {@code null}\n     * @return an unmodifiable set of decoded parameter names\n     * @see android.net.Uri#getQueryParameterNames()\n     */\n    @TargetApi(Build.VERSION_CODES.GINGERBREAD)\n    public static Set<String> getQueryParameterNames(final Uri uri) {\n        if (uri == null) {\n            throw new NullPointerException(\"uri == null\");\n        }\n        if (uri.isOpaque()) {\n            throw new UnsupportedOperationException(NOT_HIERARCHICAL);\n        }\n\n        final String query = uri.getEncodedQuery();\n        if (query == null) {\n            return Collections.emptySet();\n        }\n\n        final Set<String> names = new LinkedHashSet<>();\n        int start = 0;\n        do {\n            final int next = query.indexOf('&', start);\n            final int end = (next == -1) ? query.length() : next;\n\n            int separator = query.indexOf('=', start);\n            if (separator > end || separator == -1) {\n                separator = end;\n            }\n\n            final String name = query.substring(start, separator);\n            names.add(Uri.decode(name));\n\n            // Move start to end of name.\n            start = end + 1;\n        } while (start < query.length());\n\n        return Collections.unmodifiableSet(names);\n    }",
  "explanation": "code_hardening: Added null validation for the Uri parameter with a clear NullPointerException message and applied final modifiers to parameters and key locals to reduce accidental mutation.\nresolve_compilation_errors: Updated the signature to public static, used the diamond operator for LinkedHashSet instantiation, and referenced existing project constants and Android APIs without introducing unresolved symbols.\nexception_handling: Replaced the hardcoded exception message with the predefined NOT_HIERARCHICAL constant and explicitly documented thrown exceptions in Javadoc.\nlogic_customization: Preserved the original parsing algorithm and behavior to match Uri#getQueryParameterNames(), ensuring order preservation and an unmodifiable return set; no algorithmic changes were made.\nrefactoring: Changed visibility and scope to a utility-style method, modernized instantiation syntax, and updated Javadoc to note extraction and include a @see reference.\nmisc: Added @TargetApi(Build.VERSION_CODES.GINGERBREAD) annotation and minor comment/Javadoc formatting consistent with Android style; no new custom API calls were introduced."
}