{
  "code": "public ArrayList<Video> getStreamingUrisFromYouTubePage(String ytUrl) throws Exception {\n    if (ytUrl == null || ytUrl.length() == 0) {\n        return null;\n    }\n\n    int andIdx = ytUrl.indexOf('&');\n    if (andIdx >= 0) {\n        ytUrl = ytUrl.substring(0, andIdx);\n    }\n\n    String userAgent = \"Mozilla/5.0 (Linux; Android 10; Mobile) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Mobile Safari/537.36\";\n    String html;\n\n    HttpClient client = new DefaultHttpClient();\n    client.getParams().setParameter(CoreProtocolPNames.USER_AGENT, userAgent);\n    HttpGet request = new HttpGet(ytUrl);\n\n    try (InputStream in = client.execute(request).getEntity().getContent();\n         BufferedReader reader = new BufferedReader(new InputStreamReader(in))) {\n        StringBuilder sb = new StringBuilder();\n        String line;\n        while ((line = reader.readLine()) != null) {\n            sb.append(line);\n        }\n        html = sb.toString();\n    }\n\n    if (html == null || html.length() == 0) {\n        return null;\n    }\n\n    if (html.contains(\"verify-age-thumb\") || html.contains(\"das_captcha\")) {\n        return null;\n    }\n\n    html = html.replace(\"\\\\u0026\", \"&\").replace(\"\\\\\", \"\");\n\n    Pattern streamMapPattern = Pattern.compile(\"stream_map\\\":\\\"(.*?)\\\"\");\n    Matcher streamMapMatcher = streamMapPattern.matcher(html);\n    if (!streamMapMatcher.find()) {\n        return null;\n    }\n\n    String streamMap = streamMapMatcher.group(1);\n    if (streamMap == null || streamMap.length() == 0) {\n        return null;\n    }\n\n    HashMap<String, String> foundArray = new HashMap<String, String>();\n\n    Pattern pairPattern = Pattern.compile(\"itag=([0-9]+).*?url=([^,}]+)\");\n    Matcher pairMatcher = pairPattern.matcher(streamMap);\n    while (pairMatcher.find()) {\n        String itag = pairMatcher.group(1);\n        String rawUrl = pairMatcher.group(2);\n        if (itag != null && rawUrl != null) {\n            String cleanedUrl = rawUrl;\n            if (cleanedUrl.endsWith(\"}\")) {\n                cleanedUrl = cleanedUrl.substring(0, cleanedUrl.length() - 1);\n            }\n            cleanedUrl = URLDecoder.decode(cleanedUrl, \"UTF-8\");\n            foundArray.put(itag, cleanedUrl);\n        }\n    }\n\n    if (foundArray.size() == 0) {\n        return null;\n    }\n\n    HashMap<String, Meta> typeMap = new HashMap<String, Meta>();\n    typeMap.put(\"13\", new Meta(\"13\", \"3GP\", \"Low Quality - 176x144\"));\n    typeMap.put(\"17\", new Meta(\"17\", \"3GP\", \"Medium Quality - 176x144\"));\n    typeMap.put(\"36\", new Meta(\"36\", \"3GP\", \"High Quality - 320x240\"));\n    typeMap.put(\"5\", new Meta(\"5\", \"FLV\", \"Low Quality - 400x226\"));\n    typeMap.put(\"6\", new Meta(\"6\", \"FLV\", \"Medium Quality - 640x360\"));\n    typeMap.put(\"34\", new Meta(\"34\", \"FLV\", \"Medium Quality - 640x360\"));\n    typeMap.put(\"35\", new Meta(\"35\", \"FLV\", \"High Quality - 854x480\"));\n    typeMap.put(\"43\", new Meta(\"43\", \"WEBM\", \"Low Quality - 640x360\"));\n    typeMap.put(\"44\", new Meta(\"44\", \"WEBM\", \"Medium Quality - 854x480\"));\n    typeMap.put(\"45\", new Meta(\"45\", \"WEBM\", \"High Quality - 1280x720\"));\n    typeMap.put(\"18\", new Meta(\"18\", \"MP4\", \"Medium Quality - 480x360\"));\n    typeMap.put(\"22\", new Meta(\"22\", \"MP4\", \"High Quality - 1280x720\"));\n    typeMap.put(\"37\", new Meta(\"37\", \"MP4\", \"High Quality - 1920x1080\"));\n    typeMap.put(\"33\", new Meta(\"38\", \"MP4\", \"High Quality - 4096x230\"));\n\n    ArrayList<Video> videos = new ArrayList<Video>();\n    for (String format : typeMap.keySet()) {\n        if (foundArray.containsKey(format)) {\n            Meta meta = typeMap.get(format);\n            videos.add(new Video(meta.ext, meta.type, foundArray.get(format)));\n        }\n    }\n\n    return videos;\n}",
  "explanation": "code_hardening: Added null/empty checks for inputs, HTML content, and extracted stream_map; used try-with-resources to ensure InputStream and BufferedReader are closed; ensured parsing stops naturally when no more itag/url pairs are found.\nresolve_compilation_errors: Returned ArrayList<Video> directly; removed all logging references; ensured all regex matchers and local variables are properly declared and scoped within the function.\nexception_handling: Broadened the method signature to throw Exception; relied on the broader exception to uniformly handle IO, decoding, and parsing issues; removed logging while preserving null returns for age verification and captcha cases.\nlogic_customization: Updated the user agent to a mobile Android/Chrome UA; preprocessed HTML by converting \\u0026 to & and stripping backslashes; adjusted regex to match escaped stream_map content; replaced old URL-parameter parsing with JSON-like key/value extraction of itag and url, assuming the signature is already embedded; URL-decoded cleaned URLs and did not append signatures.\nrefactoring: Simplified parsing by using a single matcher to pair itag and url; grouped extraction and cleanup logic together for clarity while keeping the original type map and video assembly logic intact.\nmisc: Removed all logging statements; added minimal inline structure to reflect the new parsing approach; no new custom API calls were introduced."
}