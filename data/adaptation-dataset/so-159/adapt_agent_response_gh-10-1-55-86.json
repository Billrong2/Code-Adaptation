{
  "code": "public static String getIPAddress(final boolean useIPv4) throws SocketException {\n\tfinal java.util.Enumeration<java.net.NetworkInterface> interfacesEnum = java.net.NetworkInterface.getNetworkInterfaces();\n\tif (interfacesEnum == null) return \"\";\n\tfor (final java.net.NetworkInterface intf : java.util.Collections.list(interfacesEnum)) {\n\t\t// Skip down or loopback interfaces\n\t\tif (intf == null || !intf.isUp() || intf.isLoopback()) continue;\n\t\tfinal java.util.Enumeration<java.net.InetAddress> addrsEnum = intf.getInetAddresses();\n\t\tif (addrsEnum == null) continue;\n\t\tfor (final java.net.InetAddress addr : java.util.Collections.list(addrsEnum)) {\n\t\t\tif (addr == null || addr.isLoopbackAddress()) continue;\n\t\t\tfinal String hostAddress = addr.getHostAddress();\n\t\t\tif (hostAddress == null || hostAddress.length() == 0) continue;\n\t\t\tfinal boolean isIPv4 = org.apache.http.conn.util.InetAddressUtils.isIPv4Address(hostAddress);\n\t\t\tif (useIPv4) {\n\t\t\t\tif (isIPv4) return hostAddress;\n\t\t\t} else {\n\t\t\t\tif (!isIPv4) {\n\t\t\t\t\t// Strip IPv6 scope suffix (e.g., \"%wlan0\")\n\t\t\t\t\tfinal int delim = hostAddress.indexOf('%');\n\t\t\t\t\treturn (delim < 0) ? hostAddress : hostAddress.substring(0, delim);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn \"\";\n}",
  "explanation": "code_hardening: Added null checks for enumerations, interfaces, and addresses; skipped down and loopback interfaces; validated hostAddress before use; used final modifiers for locals.\nresolve_compilation_errors: Removed all file I/O usage; relied on existing fully qualified networking types where needed and used org.apache.http.conn.util.InetAddressUtils.isIPv4Address(String) consistent with available imports.\nexception_handling: Updated the signature to throw java.net.SocketException and avoided stream-related try/finally blocks; let SocketException propagate as per project pattern.\nlogic_customization: Replaced file/BOM logic with enumeration of NetworkInterface and InetAddress; filtered by useIPv4 flag; skipped loopback addresses; stripped IPv6 scope suffix after '%'; returned empty string when no suitable address is found. New custom API calls used: java.net.NetworkInterface.getNetworkInterfaces(), java.net.NetworkInterface.isUp(), java.net.InetAddress.getHostAddress(), org.apache.http.conn.util.InetAddressUtils.isIPv4Address(String).\nrefactoring: Renamed the method to getIPAddress and changed parameters to boolean useIPv4; simplified control flow and removed obsolete comments related to file loading.\nmisc: Kept formatting consistent with the existing class and added brief inline comments for clarity."
}