{
  "code": "    /**\n     * Get IP address from first non-loopback interface.\n     *\n     * @param useIPv4 true to return IPv4, false to return IPv6\n     * @return IP address as string or empty string on error/not found\n     */\n    public static String getIPAddress(boolean useIPv4) {\n        try {\n            java.util.List<java.net.NetworkInterface> interfaces = java.util.Collections\n                    .list(java.net.NetworkInterface.getNetworkInterfaces());\n            if (interfaces == null || interfaces.isEmpty()) {\n                return \"\";\n            }\n            for (java.net.NetworkInterface intf : interfaces) {\n                if (intf == null) {\n                    continue;\n                }\n                try {\n                    if (!intf.isUp() || intf.isLoopback() || intf.isVirtual()) {\n                        continue;\n                    }\n                } catch (java.net.SocketException ignore) {\n                    continue;\n                }\n                java.util.Enumeration<java.net.InetAddress> addrs = intf.getInetAddresses();\n                if (addrs == null) {\n                    continue;\n                }\n                while (addrs.hasMoreElements()) {\n                    java.net.InetAddress addr = addrs.nextElement();\n                    if (addr == null || addr.isLoopbackAddress()) {\n                        continue;\n                    }\n                    String hostAddress = addr.getHostAddress();\n                    if (hostAddress == null || hostAddress.length() == 0) {\n                        continue;\n                    }\n                    boolean isIPv4 = org.apache.http.conn.util.InetAddressUtils.isIPv4Address(hostAddress);\n                    if (useIPv4) {\n                        if (isIPv4) {\n                            return hostAddress;\n                        }\n                    } else {\n                        if (!isIPv4 && org.apache.http.conn.util.InetAddressUtils.isIPv6Address(hostAddress)) {\n                            int delim = hostAddress.indexOf('%');\n                            return (delim < 0) ? hostAddress : hostAddress.substring(0, delim);\n                        }\n                    }\n                }\n            }\n        } catch (java.net.SocketException e) {\n            // swallow and fall through\n        }\n        return \"\";\n    }",
  "explanation": "code_hardening: Added checks for null/empty interface lists, null interfaces and addresses, skipped down/loopback/virtual interfaces, and safely handled IPv6 scope ID stripping by checking the '%' index before substring.\nresolve_compilation_errors: Removed all file I/O logic and relied only on networking classes, using fully qualified names where necessary; used org.apache.http.conn.util.InetAddressUtils static methods consistent with the existing codebase.\nexception_handling: Replaced thrown IOException with internal try/catch for SocketException, swallowing exceptions and ensuring an empty string is returned on any error.\nlogic_customization: Renamed and implemented getIPAddress(boolean useIPv4) to enumerate network interfaces and addresses, select IPv4 vs IPv6 based on the flag, skip loopback addresses, and strip IPv6 scope IDs when present.\nrefactoring: Simplified control flow to straightforward interface/address iteration, used clear boolean flags for address type checks, and removed obsolete file-related logic and comments.\nmisc: Updated JavaDoc to describe network IP retrieval behavior and formatted the method to match standard Java/Android style. New custom API calls used: org.apache.http.conn.util.InetAddressUtils.isIPv4Address(String) and isIPv6Address(String)."
}