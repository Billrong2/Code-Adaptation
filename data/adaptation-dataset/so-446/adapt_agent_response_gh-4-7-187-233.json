{
  "code": "/**\n * Rotate and/or flip a bitmap based on the given EXIF orientation.\n *\n * @param bitmap The source bitmap to transform.\n * @param orientation One of {@link android.media.ExifInterface} orientation constants.\n * @return A new, transformed bitmap, the original bitmap if no transform is needed,\n *         or {@code null} if the operation fails.\n */\npublic static Bitmap rotateBitmap(final Bitmap bitmap, final int orientation)\n{\n    if(bitmap == null)\n        return null;\n\n    final Matrix matrix = new Matrix();\n    switch(orientation)\n    {\n        case ExifInterface.ORIENTATION_NORMAL:\n            return bitmap;\n        case ExifInterface.ORIENTATION_FLIP_HORIZONTAL:\n            matrix.setScale(-1, 1);\n            break;\n        case ExifInterface.ORIENTATION_ROTATE_180:\n            matrix.setRotate(180);\n            break;\n        case ExifInterface.ORIENTATION_FLIP_VERTICAL:\n            matrix.setRotate(180);\n            matrix.postScale(-1, 1);\n            break;\n        case ExifInterface.ORIENTATION_TRANSPOSE:\n            matrix.setRotate(90);\n            matrix.postScale(-1, 1);\n            break;\n        case ExifInterface.ORIENTATION_ROTATE_90:\n            matrix.setRotate(90);\n            break;\n        case ExifInterface.ORIENTATION_TRANSVERSE:\n            matrix.setRotate(-90);\n            matrix.postScale(-1, 1);\n            break;\n        case ExifInterface.ORIENTATION_ROTATE_270:\n            matrix.setRotate(-90);\n            break;\n        default:\n            return bitmap;\n    }\n\n    try\n    {\n        Bitmap rotated = Bitmap.createBitmap(\n                bitmap,\n                0,\n                0,\n                bitmap.getWidth(),\n                bitmap.getHeight(),\n                matrix,\n                true\n        );\n\n        if(rotated != bitmap)\n            bitmap.recycle();\n\n        return rotated;\n    }\n    catch(OutOfMemoryError e)\n    {\n        e.printStackTrace();\n        return null;\n    }\n}",
  "explanation": "code_hardening: Added a null check for the input Bitmap and made recycling conditional so the original bitmap is only recycled if a new bitmap is actually created. Marked parameters as final for robustness.\nresolve_compilation_errors: Preserved usage of existing Android framework classes (android.graphics.Bitmap, android.graphics.Matrix, android.media.ExifInterface) already present in the target file; no new imports or APIs were introduced.\nexception_handling: Retained the original behavior of catching only OutOfMemoryError and returning null on failure, with stack trace logging unchanged.\nlogic_customization: None; rotation logic, switch cases, matrix operations, and return behavior remain identical to the source snippet.\nrefactoring: Improved readability with minor formatting and clearer local variable naming (e.g., 'rotated') without changing structure or behavior.\nmisc: Added a Javadoc comment consistent with project style and adjusted brace/formatting style to match the surrounding code. No new custom API calls were introduced."
}