{
  "code": "private SMTPTransport connectToSmtp(String host, int port, String userEmail,\n        String oauthToken, boolean debug) throws MessagingException {\n\n    if (host == null || host.length() == 0)\n        throw new MessagingException(\"SMTP host is null or empty\");\n    if (userEmail == null || userEmail.length() == 0)\n        throw new MessagingException(\"User email is null or empty\");\n    if (oauthToken == null || oauthToken.length() == 0)\n        throw new MessagingException(\"OAuth token is null or empty\");\n\n    final Properties props = new Properties();\n    props.put(\"mail.smtp.starttls.enable\", \"true\");\n    props.put(\"mail.smtp.starttls.required\", \"true\");\n    props.put(\"mail.smtp.sasl.enable\", \"false\");\n    props.put(\"mail.smtp.ssl.enable\", \"true\");\n\n    session = Session.getInstance(props);\n    session.setDebug(debug);\n\n    final URLName unusedUrlName = null;\n    SMTPTransport transport = new SMTPTransport(session, unusedUrlName);\n\n    // If the password is non-null, SMTP tries to do AUTH LOGIN.\n    final String emptyPassword = null;\n    transport.connect(host, port, userEmail, emptyPassword);\n\n    final byte[] authBytes = String.format(\"user=%s\\1auth=Bearer %s\\1\\1\", userEmail,\n            oauthToken).getBytes();\n    final byte[] encodedResponse = BASE64EncoderStream.encode(authBytes);\n\n    transport.issueCommand(\"AUTH XOAUTH2 \" + new String(encodedResponse), 235);\n\n    return transport;\n}",
  "explanation": "code_hardening: Added null/empty validation for host, userEmail, and oauthToken before attempting any SMTP operations; marked local variables (Properties, URLName, emptyPassword, auth/encoded byte arrays) as final where applicable; preserved existing STARTTLS configuration while safely adding the SSL flag.\nresolve_compilation_errors: Used existing project types (Session, SMTPTransport, BASE64EncoderStream, MessagingException) without introducing new helpers; ensured the method relies on the already-declared session field in the class; avoided reassignment of final variables by separating encoded response bytes.\nexception_handling: Narrowed the method signature to throw MessagingException instead of generic Exception; validation failures now throw MessagingException to align with callers and existing catch blocks.\nlogic_customization: Added the SMTP property mail.smtp.ssl.enable=true while keeping STARTTLS, SASL, XOAUTH2 authentication flow, connection logic, debug setup, and return behavior unchanged; changed method visibility to private as required.\nrefactoring: No functional refactoring beyond minor local variable restructuring to allow final usage and maintain readability.\nmisc: none"
}