{
  "code": "@CheckResult\npublic static ViewAction waitForViewMatch(@NonNull final Matcher<View> viewMatcher, final long millis) {\n    if (viewMatcher == null) {\n        throw new IllegalArgumentException(\"viewMatcher must not be null\");\n    }\n    return new ViewAction() {\n        @Override\n        public Matcher<View> getConstraints() {\n            return isRoot();\n        }\n\n        @Override\n        public String getDescription() {\n            return \"wait for a view matching <\" + viewMatcher + \"> during \" + millis + \" millis.\";\n        }\n\n        @Override\n        public void perform(final UiController uiController, final View view) {\n            uiController.loopMainThreadUntilIdle();\n            final long startTime = SystemClock.elapsedRealtime();\n            final long endTime = startTime + millis;\n\n            do {\n                for (View child : TreeIterables.breadthFirstViewTraversal(view)) {\n                    if (viewMatcher.matches(child)) {\n                        return;\n                    }\n                }\n                uiController.loopMainThreadForAtLeast(50);\n            } while (SystemClock.elapsedRealtime() <= endTime);\n\n            throw new PerformException.Builder()\n                    .withActionDescription(getDescription())\n                    .withViewDescription(HumanReadables.describe(view))\n                    .withCause(new TimeoutException())\n                    .build();\n        }\n    };\n}",
  "explanation": "code_hardening: Added a fast-fail null check for the passed-in Matcher<View> and marked parameters as final to prevent accidental reassignment while keeping polling and timeout behavior intact.\nresolve_compilation_errors: Updated the method name and signature to waitForViewMatch(Matcher<View>, long), removed all ID/withId references, and relied on existing project imports such as Matcher<View>, isRoot(), TreeIterables, and @CheckResult.\nexception_handling: Preserved timeout behavior by throwing PerformException with a TimeoutException and included both action and view descriptions to aid debugging.\nlogic_customization: Replaced the internally constructed ID-based matcher with the externally provided Matcher<View> and applied it directly during breadth-first traversal of the view hierarchy.\nrefactoring: Renamed the method and updated the description text to reflect matcher-based waiting rather than ID-based logic, and clarified variable naming around matcher usage.\nmisc: Added the @CheckResult annotation as requested and kept comments/logging minimal and consistent with existing EspressoUtil style; new custom API calls: none."
}