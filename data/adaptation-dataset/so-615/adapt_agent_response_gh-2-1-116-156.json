{
  "code": "protected static Bitmap bitmapForUri(Context context, Uri imageUri) throws IOException {\n\tif (imageUri == null) {\n\t\treturn BitmapFactory.decodeResource(context.getResources(), edu.northwestern.cbits.purple.notifier.R.drawable.ic_launcher);\n\t}\n\n\tInputStream input = null;\n\n\ttry {\n\t\tinput = PurpleWidgetProvider.inputStreamForUri(context, imageUri);\n\n\t\tif (input == null)\n\t\t\treturn null;\n\n\t\tBitmapFactory.Options onlyBoundsOptions = new BitmapFactory.Options();\n\t\tonlyBoundsOptions.inJustDecodeBounds = true;\n\t\tonlyBoundsOptions.inDither = true;\n\t\tonlyBoundsOptions.inPreferredConfig = Bitmap.Config.ARGB_8888;\n\n\t\tBitmapFactory.decodeStream(input, null, onlyBoundsOptions);\n\t} finally {\n\t\tif (input != null)\n\t\t\tinput.close();\n\t}\n\n\tif ((onlyBoundsOptions.outWidth == -1) || (onlyBoundsOptions.outHeight == -1))\n\t\treturn null;\n\n\tint originalSize = (onlyBoundsOptions.outHeight > onlyBoundsOptions.outWidth) ? onlyBoundsOptions.outHeight : onlyBoundsOptions.outWidth;\n\n\tdouble ratio = (originalSize > 144) ? (originalSize / 144.0) : 1.0;\n\n\tBitmapFactory.Options bitmapOptions = new BitmapFactory.Options();\n\tbitmapOptions.inSampleSize = PurpleWidgetProvider.getPowerOfTwoForSampleRatio(ratio);\n\tbitmapOptions.inDither = true;\n\tbitmapOptions.inPreferredConfig = Bitmap.Config.ARGB_8888;\n\n\ttry {\n\t\tinput = PurpleWidgetProvider.inputStreamForUri(context, imageUri);\n\n\t\tif (input == null)\n\t\t\treturn null;\n\n\t\treturn BitmapFactory.decodeStream(input, null, bitmapOptions);\n\t} finally {\n\t\tif (input != null)\n\t\t\tinput.close();\n\t}\n}",
  "explanation": "code_hardening: Added a null check for the Uri that returns a default launcher bitmap from resources, checked for null InputStreams returned by the helper and returned null early, and ensured both decode-pass InputStreams are always closed using finally blocks while preserving decode options.\nresolve_compilation_errors: Updated the method signature to protected static bitmapForUri(Context, Uri) throws IOException, removed instance ContentResolver usage, and replaced stream opening with PurpleWidgetProvider.inputStreamForUri(context, uri). Replaced the local helper call with PurpleWidgetProvider.getPowerOfTwoForSampleRatio and removed any references to THUMBNAIL_SIZE.\nexception_handling: Simplified the throws clause to only IOException, relied on null returns where specified instead of propagating open failures, and allowed IOExceptions from stream closing to propagate per the signature.\nlogic_customization: Replaced THUMBNAIL_SIZE with a fixed target size of 144 when computing the sampling ratio, while preserving the decode-bounds-then-decode flow and bitmap options. Used PurpleWidgetProvider.getPowerOfTwoForSampleRatio(double).\nrefactoring: Renamed the method to bitmapForUri, changed scope to protected static, introduced a Context parameter, and centralized all stream access through the PurpleWidgetProvider helper for both decode passes.\nmisc: none"
}