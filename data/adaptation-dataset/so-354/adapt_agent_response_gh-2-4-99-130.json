{
"code":"@Override\npublic void mousePressed(MouseEvent e) {\n    if (e == null || popup == null) {\n        return;\n    }\n\n    // Only react to right-click / popup trigger\n    if (!e.isPopupTrigger() && (e.getModifiersEx() & InputEvent.BUTTON3_DOWN_MASK) == 0) {\n        return;\n    }\n\n    Object source = e.getSource();\n    if (!(source instanceof JTextComponent)) {\n        return;\n    }\n\n    textComponent = (JTextComponent) source;\n\n    // Request focus safely\n    if (textComponent.isEnabled()) {\n        textComponent.requestFocusInWindow();\n    }\n\n    boolean isEnabled = textComponent.isEnabled();\n    boolean isEditable = textComponent.isEditable();\n    boolean hasSelection = textComponent.getSelectionStart() != textComponent.getSelectionEnd();\n    boolean hasText = textComponent.getDocument() != null && textComponent.getDocument().getLength() > 0;\n\n    // Determine clipboard string availability\n    boolean hasClipboardString = false;\n    try {\n        java.awt.datatransfer.Transferable t = Toolkit.getDefaultToolkit()\n                .getSystemClipboard().getContents(null);\n        if (t != null && t.isDataFlavorSupported(DataFlavor.stringFlavor)) {\n            Object data = t.getTransferData(DataFlavor.stringFlavor);\n            hasClipboardString = data instanceof String && !((String) data).isEmpty();\n        }\n    } catch (IllegalStateException | java.awt.datatransfer.UnsupportedFlavorException | java.io.IOException ex) {\n        hasClipboardString = false;\n    }\n\n    // Enable/disable actions dynamically\n    if (undoAction != null) {\n        boolean undoAllowed = (lastActionSelected == Actions.CUT || lastActionSelected == Actions.PASTE)\n                && isEnabled && isEditable;\n        undoAction.setEnabled(undoAllowed);\n    }\n\n    if (cutAction != null) {\n        cutAction.setEnabled(isEnabled && isEditable && hasSelection);\n    }\n\n    if (copyAction != null) {\n        copyAction.setEnabled(hasSelection);\n    }\n\n    if (pasteAction != null) {\n        pasteAction.setEnabled(isEnabled && isEditable && hasClipboardString);\n    }\n\n    if (selectAllAction != null) {\n        selectAllAction.setEnabled(isEnabled && hasText);\n    }\n\n    // Compute popup position relative to component and keep within bounds\n    int x = e.getX();\n    int y = e.getY();\n\n    java.awt.Dimension popupSize = popup.getPreferredSize();\n    if (popupSize != null) {\n        int compWidth = textComponent.getWidth();\n        int compHeight = textComponent.getHeight();\n\n        if (x + popupSize.width > compWidth) {\n            x = Math.max(0, compWidth - popupSize.width);\n        }\n\n        // Place above cursor if possible\n        if (y + popupSize.height > compHeight) {\n            y = Math.max(0, y - popupSize.height);\n        }\n    }\n\n    popup.show(textComponent, x, y);\n}",
"explanation":"code_hardening: Added null checks for the MouseEvent, popup menu, and event source; guarded against non-JTextComponent sources; ensured focus is requested only when the component is enabled; validated document, selection, and clipboard contents before use.\nresolve_compilation_errors: Used existing fields from the class (popup, actions, textComponent, Actions enum) and fully qualified clipboard-related types inside the method to avoid import issues; moved all context-menu logic into a MouseAdapter override so the code compiles without constructor-side event logic.\nexception_handling: Wrapped clipboard access in a try/catch handling IllegalStateException, UnsupportedFlavorException, and IOException so clipboard failures do not prevent the popup from appearing.\nlogic_customization: Implemented right-click detection via isPopupTrigger and BUTTON3 mask; dynamically determined the JTextComponent from the event source; computed enabled state for Undo, Cut, Copy, Paste, and Select All based on component state, selection, clipboard contents, and lastActionSelected; calculated popup coordinates near the cursor and adjusted them to remain within component bounds, placing the menu above the cursor when needed.\nrefactoring: Centralized all enable/disable and popup-display logic in a single mouse event handler instead of the constructor, reducing duplication and clarifying responsibilities; used descriptive local booleans for readability.\nmisc: Updated inline comments to reflect right-clickâ€“driven popup behavior and followed typical Swing conventions for popup triggering and positioning."}