{
  "code": "public static Camera.Size getOptimalPreviewSize(int w, int h) {\n    final double ASPECT_TOLERANCE = 0.1;\n\n    if (ManagerCamera.mCamera == null) {\n      return null;\n    }\n\n    Camera.Parameters parameters = ManagerCamera.mCamera.getParameters();\n    if (parameters == null) {\n      return null;\n    }\n\n    java.util.List<Camera.Size> sizes = parameters.getSupportedPreviewSizes();\n    if (sizes == null) {\n      return null;\n    }\n\n    double targetRatio = (double) h / (double) w;\n    Camera.Size optimalSize = null;\n    double minDiff = Double.MAX_VALUE;\n    int targetHeight = h;\n\n    for (Camera.Size size : sizes) {\n      double ratio = (double) size.width / (double) size.height;\n      if (Math.abs(ratio - targetRatio) > ASPECT_TOLERANCE) {\n        continue;\n      }\n\n      double heightDiff = Math.abs(size.height - targetHeight);\n      if (heightDiff < minDiff) {\n        optimalSize = size;\n        minDiff = heightDiff;\n      }\n    }\n\n    if (optimalSize == null) {\n      minDiff = Double.MAX_VALUE;\n      for (Camera.Size size : sizes) {\n        double heightDiff = Math.abs(size.height - targetHeight);\n        if (heightDiff < minDiff) {\n          optimalSize = size;\n          minDiff = heightDiff;\n        }\n      }\n    }\n\n    return optimalSize;\n  }",
  "explanation": "code_hardening: Added early null-guards for ManagerCamera.mCamera, Camera.Parameters, and the supported preview sizes list; kept calculations defensive and avoided dereferencing nulls.\nresolve_compilation_errors: Removed the sizes parameter, made the method static, and fetched preview sizes locally via ManagerCamera.mCamera.getParameters().getSupportedPreviewSizes(); used Camera.Parameters and Camera.Size with fully qualified java.util.List inside the function.\nexception_handling: none.\nlogic_customization: Switched the data source from an external list to the active camera managed by ManagerCamera while preserving the original aspect-ratio tolerance algorithm and the fallback selection when no ratio match is found; new API calls used: android.hardware.Camera.getParameters() and android.hardware.Camera.Parameters.getSupportedPreviewSizes().\nrefactoring: Reduced the parameter list to (w, h), introduced clearer local variable names (parameters, targetHeight), and localized the ASPECT_TOLERANCE constant within the method.\nmisc: none."
}