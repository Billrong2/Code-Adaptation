package org.coreasm.compiler.components.backend;

import java.io.BufferedInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.jar.Attributes;
import java.util.jar.JarEntry;
import java.util.jar.JarOutputStream;
import java.util.jar.Manifest;

import org.coreasm.compiler.CompilerEngine;
import org.coreasm.compiler.CompilerOptions;
import org.coreasm.compiler.exception.CompilerException;



public class JarPacker {	
	
	public static void packJar(CompilerOptions options, CompilerEngine engine) throws CompilerException{
		JarOutputStream target = null;
		try{
			Manifest manifest = new Manifest();
			manifest.getMainAttributes().put(Attributes.Name.MANIFEST_VERSION, "1.0");
			manifest.getMainAttributes().put(Attributes.Name.MAIN_CLASS, "Main");
			target = new JarOutputStream(new FileOutputStream(options.outputFile), manifest);
			File root = options.tempDirectory;
			for(File f : root.listFiles()){
				addFile(f, target, options);
			}
		}
		catch(Exception e){
			engine.addError("Could not pack jar: " + e.getMessage());
			throw new CompilerException(e);
		}
		finally{
			if(target != null)
				try {
					target.close();
				} catch (IOException e) {
					engine.getLogger().error(JarPacker.class, "Could not close jar stream");
				}
		}
	}
	
		// TODO

}
