{
  "code": "@Override\nprotected void onLayout(boolean changed, int l, int t, int r, int b) {\n    final int count = getChildCount();\n    if (count == 0) {\n        return;\n    }\n\n    final int paddingLeft = Math.max(0, getPaddingLeft());\n    final int paddingTop = Math.max(0, getPaddingTop());\n    final int parentWidth = Math.max(0, r - l);\n\n    int curX = paddingLeft;\n    int curY = paddingTop;\n    int lineHeight = 0;\n\n    for (int i = 0; i < count; i++) {\n        final View child = getChildAt(i);\n        if (child == null || child.getVisibility() == GONE) {\n            continue;\n        }\n\n        ViewGroup.LayoutParams rawLp = child.getLayoutParams();\n        if (!(rawLp instanceof LayoutParams)) {\n            continue; // defensive: unexpected LayoutParams\n        }\n        final LayoutParams lp = (LayoutParams) rawLp;\n\n        final int childWidth = child.getMeasuredWidth();\n        final int childHeight = child.getMeasuredHeight();\n        if (childWidth <= 0 || childHeight <= 0) {\n            continue;\n        }\n\n        final int horizontalSpacing = Math.max(0, lp.horizontal_spacing);\n        final int verticalSpacing = Math.max(0, lp.vertical_spacing);\n\n        // Wrap to next line if this child would exceed available width\n        if (curX + childWidth > parentWidth) {\n            curX = paddingLeft;\n            curY += lineHeight;\n            lineHeight = 0;\n        }\n\n        // Layout the child\n        child.layout(curX, curY, curX + childWidth, curY + childHeight);\n\n        // Advance cursor and update line height\n        curX += childWidth + horizontalSpacing;\n        lineHeight = Math.max(lineHeight, childHeight + verticalSpacing);\n    }\n}",
  "explanation": "code_hardening: Added defensive checks for zero children, null child views, unexpected LayoutParams types, non-positive measured sizes, and clamped padding/spacing values to non-negative to avoid invalid layout offsets.\nresolve_compilation_errors: Implemented the correct onLayout(boolean, int, int, int, int) signature, removed all MeasureSpec usage and setMeasuredDimension calls, and relied solely on layout bounds (r - l) and existing measured child sizes.\nexception_handling: none.\nlogic_customization: Moved flow/wrapping logic entirely into onLayout, used each childâ€™s already-measured width/height without re-measuring, wrapped when curX + childWidth exceeds total parent width (r - l), honored left/top padding for initial positions, and advanced positions using child dimensions plus spacing.\nrefactoring: Renamed variables for clarity (curX, curY, lineHeight), extracted padding and parent width into final locals, and simplified control flow now that measurement concerns are removed.\nmisc: Updated inline comments to reflect layout-only responsibility and kept formatting consistent with existing style. New custom API calls: none."
}