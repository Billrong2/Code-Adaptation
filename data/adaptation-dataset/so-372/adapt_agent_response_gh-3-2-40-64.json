{
  "code": "private void refitText(String text, int textWidth) {\n    // Constants\n    final float MIN_TEXT_SIZE_PX = 10f;\n    final float MEASURE_THRESHOLD_PX = 0.5f;\n\n    // Code hardening\n    final String safeText = text != null ? text : \"\";\n    int targetWidth = textWidth - getPaddingLeft() - getPaddingRight();\n    if (targetWidth <= 0) {\n        targetWidth = 1; // clamp to a minimal positive width\n    }\n\n    // Prepare paint for measurement\n    mTestPaint.set(getPaint());\n\n    // Binary search bounds\n    float lowerBound = MIN_TEXT_SIZE_PX;\n    float upperBound = maxTextSize;\n\n    // Always run binary search to compute final size\n    while (upperBound - lowerBound > MEASURE_THRESHOLD_PX) {\n        float testSize = (upperBound + lowerBound) / 2f;\n        mTestPaint.setTextSize(testSize);\n        if (mTestPaint.measureText(safeText) >= targetWidth) {\n            upperBound = testSize; // too big\n        } else {\n            lowerBound = testSize; // too small\n        }\n    }\n\n    // Apply undershoot result via superclass to avoid override recursion\n    super.setTextSize(TypedValue.COMPLEX_UNIT_PX, lowerBound);\n}",
  "explanation": "code_hardening: Added a null-check for the text by normalizing it to an empty string, clamped targetWidth to a minimum positive value to avoid invalid measurements, and introduced named constants for minimum text size and threshold.\nresolve_compilation_errors: Used existing in-scope fields mTestPaint and maxTextSize, relied on getPaddingLeft/Right from TextView, and applied the final size via super.setTextSize(TypedValue.COMPLEX_UNIT_PX, ...) to avoid recursion with overridden setters.\nexception_handling: none.\nlogic_customization: Removed all early-return special cases and default-size prechecks, always executed the binary search, changed bounds to [10, maxTextSize], eliminated use of any defaultTextSize, and applied the final size based solely on the undershoot result of the search.\nrefactoring: Replaced magic numbers with named constants, renamed hi/lo to upperBound/lowerBound for clarity, and simplified control flow to focus exclusively on binary search sizing.\nmisc: none."
}