package se.springworks.android.utils.stream;

import java.io.ByteArrayOutputStream;
import java.io.Closeable;
import java.io.FilterInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.nio.ByteBuffer;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;

public class StreamUtils {

		// TODO

	
	
	public static String getAsString(InputStream is) {
		if(is == null) {
			return null;
		}
		java.util.Scanner s = new java.util.Scanner(is).useDelimiter("\\A");
	    return s.hasNext() ? s.next() : null;
	}
	
	
	public static String getAsString(InputStream is, String encoding) {
		if(is == null) {
			return null;
		}
		java.util.Scanner s = new java.util.Scanner(is, encoding).useDelimiter("\\A");
	    return s.hasNext() ? s.next() : null;
	}
	
	public static byte[] getAsBytes(InputStream is, int bufferSize)
			throws IOException {
		ByteArrayOutputStream baos = new ByteArrayOutputStream(bufferSize);
		int oneByte;
		while ((oneByte = is.read()) != -1) {
			baos.write(oneByte);
		}
		return baos.toByteArray();
	}

	public static byte[] getAsBytes(InputStream is) throws IOException {
		return getAsBytes(is, 32);
	}

	
	public static class FlushedInputStream extends FilterInputStream {
		public FlushedInputStream(InputStream inputStream) {
			super(inputStream);
		}

		@Override
		public long skip(long n) throws IOException {
			long totalBytesSkipped = 0L;
			while (totalBytesSkipped < n) {
				long bytesSkipped = this.in.skip(n - totalBytesSkipped);
				if (bytesSkipped == 0L) {
					int byteValue = read();
					if (byteValue < 0) {
						break; 
					}
					bytesSkipped = 1; 
				}
				totalBytesSkipped += bytesSkipped;
			}
			return totalBytesSkipped;
		}
	}
	
	
	public static void closeSilently(Closeable closable) {
		if(closable == null) {
			return;
		}
		try {
			closable.close();
		} catch (IOException e) {
			
		}
	}
}
