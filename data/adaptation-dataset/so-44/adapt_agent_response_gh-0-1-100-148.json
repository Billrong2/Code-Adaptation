{
  "code": "private static byte[] createFakeSms(Context context, String sender, String body) {\n    // Context is intentionally unused; method now only builds and returns an SMS PDU\n    if (sender == null || body == null) {\n        return null;\n    }\n\n    final String SERVICE_CENTER_NUMBER = \"0000000000\";\n    final int SMS_DELIVER_PDU_TYPE = 0x04;\n    final byte GSM_7BIT_ENCODING = 0x00;\n\n    try {\n        byte[] scBytes = android.telephony.PhoneNumberUtils\n                .networkPortionToCalledPartyBCD(SERVICE_CENTER_NUMBER);\n        byte[] senderBytes = android.telephony.PhoneNumberUtils\n                .networkPortionToCalledPartyBCD(sender);\n\n        int lsmcs = scBytes != null ? scBytes.length : 0;\n\n        byte[] dateBytes = new byte[7];\n        java.util.Calendar calendar = new java.util.GregorianCalendar();\n        dateBytes[0] = reverseByte((byte) (calendar.get(java.util.Calendar.YEAR)));\n        dateBytes[1] = reverseByte((byte) (calendar.get(java.util.Calendar.MONTH) + 1));\n        dateBytes[2] = reverseByte((byte) (calendar.get(java.util.Calendar.DAY_OF_MONTH)));\n        dateBytes[3] = reverseByte((byte) (calendar.get(java.util.Calendar.HOUR_OF_DAY)));\n        dateBytes[4] = reverseByte((byte) (calendar.get(java.util.Calendar.MINUTE)));\n        dateBytes[5] = reverseByte((byte) (calendar.get(java.util.Calendar.SECOND)));\n        int tzQuarters = (calendar.get(java.util.Calendar.ZONE_OFFSET)\n                + calendar.get(java.util.Calendar.DST_OFFSET)) / (60 * 1000 * 15);\n        dateBytes[6] = reverseByte((byte) tzQuarters);\n\n        try (java.io.ByteArrayOutputStream outputStream = new java.io.ByteArrayOutputStream()) {\n            outputStream.write(lsmcs);\n            if (scBytes != null) {\n                outputStream.write(scBytes);\n            }\n            outputStream.write(SMS_DELIVER_PDU_TYPE);\n            outputStream.write((byte) sender.length());\n            if (senderBytes != null) {\n                outputStream.write(senderBytes);\n            }\n            outputStream.write(0x00); // PID\n            outputStream.write(GSM_7BIT_ENCODING); // DCS: default 7-bit encoding\n            outputStream.write(dateBytes);\n\n            try {\n                String reflectedClassName = \"com.android.internal.telephony.GsmAlphabet\";\n                Class<?> gsmAlphabetClass = Class.forName(reflectedClassName);\n                java.lang.reflect.Method stringToGsm7BitPacked = gsmAlphabetClass\n                        .getMethod(\"stringToGsm7BitPacked\", String.class);\n                stringToGsm7BitPacked.setAccessible(true);\n                byte[] bodyBytes = (byte[]) stringToGsm7BitPacked.invoke(null, body);\n                if (bodyBytes != null) {\n                    outputStream.write(bodyBytes);\n                }\n            } catch (Exception reflectionException) {\n                android.util.Log.w(TAG, \"Failed to encode SMS body\", reflectionException);\n                return null;\n            }\n\n            return outputStream.toByteArray();\n        }\n    } catch (Exception e) {\n        android.util.Log.w(TAG, \"Failed to build SMS PDU\", e);\n        return null;\n    }\n}",
  "explanation": "code_hardening: Added null checks for sender and body, validated intermediate byte arrays, and used try-with-resources for ByteArrayOutputStream to ensure proper cleanup.\nresolve_compilation_errors: Removed all Intent- and service-related logic; kept the Context parameter but marked it unused. Fully qualified Android/Java classes inside the function to avoid missing imports, and isolated reflective access to GsmAlphabet.\nexception_handling: Replaced empty catch blocks with logging and a clear failure signal by returning null when PDU construction or reflection fails.\nlogic_customization: Changed the method to return byte[] instead of void and return the constructed PDU directly. All side effects (Intent creation, extras, startService) were removed.\nrefactoring: Introduced named local constants for magic values, improved variable names (outputStream), and simplified control flow while keeping the original PDU construction logic intact.\nmisc: Updated comments to reflect the new responsibility (PDU generation only) and aligned formatting with standard Java style. New custom API calls used: none."
}