{
  "code": "private String getOriginalURL(final javax.servlet.http.HttpServletRequest req) {\n        // Rebuilds the original request URL (scheme, host, port, paths, query)\n        if (req == null) {\n            return \"\";\n        }\n\n        final String scheme = req.getScheme();             // http\n        final String serverName = req.getServerName();     // hostname.com\n        final int serverPort = req.getServerPort();        // 80\n        final String contextPath = req.getContextPath();   // /mywebapp\n        final String servletPath = req.getServletPath();   // /servlet/MyServlet\n        final String pathInfo = req.getPathInfo();         // /a/b;c=123\n        final String queryString = req.getQueryString();   // d=789\n\n        final StringBuilder url = new StringBuilder();\n        url.append(scheme).append(\"://\").append(serverName);\n\n        if (serverPort != 80 && serverPort != 443) {\n            url.append(\":\").append(serverPort);\n        }\n\n        url.append(contextPath).append(servletPath);\n\n        if (pathInfo != null) {\n            url.append(pathInfo);\n        }\n        if (queryString != null) {\n            url.append(\"?\").append(queryString);\n        }\n        return url.toString();\n    }",
  "explanation": "code_hardening: Added a null guard for the HttpServletRequest parameter to avoid NullPointerException, and marked local variables as final for clarity and immutability.\nresolve_compilation_errors: Renamed the method to getOriginalURL and made it a private instance method so buildErrorMessage can call it directly; used the fully qualified javax.servlet.http.HttpServletRequest type to avoid import assumptions.\nexception_handling: none.\nlogic_customization: Preserved the URL reconstruction logic exactly as in the original snippet (scheme, host, non-default port handling, contextPath, servletPath, optional pathInfo, optional queryString).\nrefactoring: Renamed getURL to getOriginalURL, removed static, restricted visibility to private, and added a brief clarifying comment.\nmisc: Minor formatting adjustments consistent with existing code style; no new custom API calls were introduced."
}