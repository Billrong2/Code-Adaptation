package com.eveningoutpost.dexdrip.Models;

import android.util.Log;

import org.apache.commons.math3.linear.MatrixUtils;
import org.apache.commons.math3.linear.RealMatrix;
import org.apache.commons.math3.stat.regression.OLSMultipleLinearRegression;

import java.util.Arrays;
import java.util.List;


public class Forecast {

    private static final String TAG = "jamorham forecast";
    

    public interface TrendLine {
        public void setValues(double[] y, double[] x); 
        public double predict(double x); 
        public double errorVarience();
    }
    public abstract static class OLSTrendLine implements TrendLine {

        RealMatrix coef = null; 
        Double last_error_rate = null;
        protected abstract double[] xVector(double x); 
        protected abstract boolean logY(); 


        // TODO


        @Override
        public double predict(double x) {
            double yhat = coef.preMultiply(xVector(x))[0]; 
            if (logY()) yhat = (Math.exp(yhat)); 
            return yhat;
        }

        public static double[] toPrimitive(Double[] array) {
            if (array == null) {
                return null;
            } else if (array.length == 0) {
                return new double[0];
            }
            final double[] result = new double[array.length];
            for (int i = 0; i < array.length; i++) {
                result[i] = array[i];
            }
            return result;
        }
        public static double[] toPrimitiveFromList(List<Double> array) {
            if (array == null) {
                return null;
            } else if (array.size() == 0) {
                return new double[0];
            }
            final double[] result = new double[array.size()];
            for (int i = 0; i < array.size(); i++) {
                result[i] = array.get(i);
            }
            return result;
        }
            public  double errorVarience()
            {
             return last_error_rate;
            }

    }
    public static class PolyTrendLine extends OLSTrendLine {
        final int degree;
        public PolyTrendLine(int degree) {
            if (degree < 0) throw new IllegalArgumentException("The degree of the polynomial must not be negative");
            this.degree = degree;
        }
        protected double[] xVector(double x) { 
            double[] poly = new double[degree+1];
            double xi=1;
            for(int i=0; i<=degree; i++) {
                poly[i]=xi;
                xi*=x;
            }
            return poly;
        }
        @Override
        protected boolean logY() {return false;}
    }

    public static class ExpTrendLine extends OLSTrendLine {
        @Override
        protected double[] xVector(double x) {
            return new double[]{1,x};
        }

        @Override
        protected boolean logY() {return true;}
    }

    public static class PowerTrendLine extends OLSTrendLine {
        @Override
        protected double[] xVector(double x) {
            return new double[]{1,Math.log(x)};
        }

        @Override
        protected boolean logY() {return true;}

    }

    public static class LogTrendLine extends OLSTrendLine {
        @Override
        protected double[] xVector(double x) {
            return new double[]{1,Math.log(x)};
        }

        @Override
        protected boolean logY() {return false;}
    }


}
