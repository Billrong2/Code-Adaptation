{
  "code": "public void resizeText(int width, int height) {\n        CharSequence text = getText();\n        if (text == null || text.length() == 0 || height <= 0 || width <= 0) {\n            return;\n        }\n\n        TextPaint textPaint = getPaint();\n        if (textPaint == null) {\n            return;\n        }\n\n        float oldTextSize = textPaint.getTextSize();\n\n        // Initialize target size to the lesser of current size and max size (if set)\n        float targetTextSize = oldTextSize;\n        if (mMaxTextSize > 0 && mMaxTextSize < targetTextSize) {\n            targetTextSize = mMaxTextSize;\n        }\n\n        // Ensure sane bounds\n        if (targetTextSize < mMinTextSize) {\n            targetTextSize = mMinTextSize;\n        }\n\n        // Decrement-by-2 loop: only ensure text height fits\n        int textHeight = getTextHeight(text, textPaint, width, targetTextSize);\n        while (textHeight > height && targetTextSize > mMinTextSize) {\n            float nextSize = targetTextSize - 2f;\n            if (nextSize < mMinTextSize) {\n                nextSize = mMinTextSize;\n            }\n            // Stop if no progress can be made\n            if (nextSize == targetTextSize) {\n                break;\n            }\n            targetTextSize = nextSize;\n            textHeight = getTextHeight(text, textPaint, width, targetTextSize);\n        }\n\n        // If at minimum size and still too tall, append ellipsis (height-only trigger)\n        if (mAddEllipsis && targetTextSize == mMinTextSize && textHeight > height) {\n            // Build layout with a copied paint, but do not change its text size\n            TextPaint paintCopy = new TextPaint(textPaint);\n            StaticLayout layout = new StaticLayout(text, paintCopy, width,\n                    Alignment.ALIGN_NORMAL, mSpacingMult, mSpacingAdd, false);\n\n            if (layout.getLineCount() > 0) {\n                int lastLine = layout.getLineForVertical(height) - 1;\n                if (lastLine < 0) {\n                    setText(\"\");\n                } else {\n                    int start = layout.getLineStart(lastLine);\n                    int end = layout.getLineEnd(lastLine);\n                    float lineWidth = layout.getLineWidth(lastLine);\n                    // Measure ellipsis and text using the original TextPaint\n                    float ellipseWidth = textPaint.measureText(mEllipsis);\n\n                    // Trim characters until ellipsis fits\n                    while (end > start && width < lineWidth + ellipseWidth) {\n                        end--;\n                        lineWidth = textPaint.measureText(text.subSequence(start, end).toString());\n                    }\n                    setText(text.subSequence(0, end) + mEllipsis);\n                }\n            }\n        }\n\n        // Apply final text size and reset line spacing\n        setTextSize(TypedValue.COMPLEX_UNIT_PX, targetTextSize);\n        setLineSpacing(mSpacingAdd, mSpacingMult);\n\n        // Notify listener\n        if (mTextResizeListener != null) {\n            mTextResizeListener.onTextResize(this, oldTextSize, targetTextSize);\n        }\n\n        // Reset resize flag\n        mNeedsResize = false;\n    }",
  "explanation": "code_hardening: Added null/empty checks for text and TextPaint, validated width/height, clamped targetTextSize to min/max bounds, and ensured the decrement loop cannot stall or go below the minimum size.\nresolve_compilation_errors: Removed all bisection-related variables and width-based helpers, relied only on getTextHeight which exists in the class, and aligned StaticLayout and measureText calls to available APIs without introducing missing symbols.\nexception_handling: none.\nlogic_customization: Initialized targetTextSize to min(current text size, mMaxTextSize when set), replaced bisection with a decrement-by-2 loop that checks only text height, removed width-based fit logic during resizing, triggered ellipsis solely when height still overflows at the minimum size, and updated ellipsis handling to build StaticLayout with a copied paint without setting text size while measuring ellipsis and line widths using the original TextPaint.\nrefactoring: Simplified control flow by removing obsolete bisection logic and variables, clarified variable names around height-only fitting, and avoided duplicate or unnecessary measurements.\nmisc: Updated inline comments to reflect height-only resizing behavior and preserved existing line-spacing reset, listener notification, and resize-flag reset behavior. New custom API calls: none."
}