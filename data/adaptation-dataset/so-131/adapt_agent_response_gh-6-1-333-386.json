{
"code":"    /**\n     * Unpack a ZIP archive into the given preset directory.\n     * <p>\n     * Source: https://stackoverflow.com/questions/3382996/how-to-unzip-files-programmatically-in-android\n     * </p>\n     *\n     * @param presetDir the target directory where the ZIP contents will be extracted (must end with a file separator)\n     * @param zipname   the name of the ZIP file located in {@code presetDir}\n     * @return {@code true} if the ZIP was successfully unpacked, {@code false} otherwise\n     */\n    private boolean unpackZip(final String presetDir, final String zipname) {\n        if (presetDir == null || presetDir.length() == 0 || zipname == null || zipname.length() == 0) {\n            return false;\n        }\n\n        final File baseDir = new File(presetDir);\n        try (InputStream is = new FileInputStream(new File(baseDir, zipname));\n             ZipInputStream zis = new ZipInputStream(new BufferedInputStream(is))) {\n\n            ZipEntry ze;\n            final byte[] buffer = new byte[1024];\n\n            final String baseCanonicalPath = baseDir.getCanonicalPath();\n\n            while ((ze = zis.getNextEntry()) != null) {\n                final String entryName = ze.getName();\n                if (entryName == null || entryName.length() == 0) {\n                    zis.closeEntry();\n                    continue;\n                }\n\n                final File outFile = new File(baseDir, entryName);\n                final String outCanonicalPath = outFile.getCanonicalPath();\n                // Guard against directory traversal (\"../\")\n                if (!outCanonicalPath.startsWith(baseCanonicalPath)) {\n                    zis.closeEntry();\n                    continue;\n                }\n\n                if (ze.isDirectory()) {\n                    if (!outFile.exists() && !outFile.mkdirs()) {\n                        return false;\n                    }\n                    zis.closeEntry();\n                    continue;\n                }\n\n                File parent = outFile.getParentFile();\n                if (parent != null && !parent.exists() && !parent.mkdirs()) {\n                    return false;\n                }\n\n                try (FileOutputStream fout = new FileOutputStream(outFile)) {\n                    int count;\n                    while ((count = zis.read(buffer)) != -1) {\n                        fout.write(buffer, 0, count);\n                    }\n                }\n                zis.closeEntry();\n            }\n        } catch (java.io.FileNotFoundException e) {\n            Log.w(\"PresetEditorActivity\", \"ZIP file not found: \" + zipname, e);\n            return false;\n        } catch (IOException e) {\n            Log.w(\"PresetEditorActivity\", \"Error unpacking ZIP file: \" + zipname, e);\n            return false;\n        }\n        return true;\n    }",
"explanation":"code_hardening: Added null/empty validation for presetDir and zipname, used try-with-resources for FileInputStream, ZipInputStream, and FileOutputStream, ensured parent directories are created, and added a canonical-path check to guard against directory traversal via ZipEntry names.\nresolve_compilation_errors: Renamed the parameter from path to presetDir and updated all internal references accordingly; relied on existing java.io and java.util.zip classes already present in the file without introducing unresolved symbols.\nexception_handling: Split handling between FileNotFoundException and general IOException, logged warnings consistently, and ensured all failure paths return false.\nlogic_customization: Preserved the original unzip behavior and call semantics used by download/downloadPresetData, including directory creation and byte-wise copy, without altering functional outcomes.\nrefactoring: Added a Javadoc comment with a Stack Overflow source link and basic @param/@return descriptions, marked parameters and key locals as final, and applied minor formatting and brace/whitespace adjustments for readability.\nmisc: none"}