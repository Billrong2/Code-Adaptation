{
  "code": "@Override\nprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n  final int widthMode = MeasureSpec.getMode(widthMeasureSpec);\n  final int heightMode = MeasureSpec.getMode(heightMeasureSpec);\n\n  int maxInternalWidth = MeasureSpec.getSize(widthMeasureSpec) - getHorizontalPadding();\n  int maxInternalHeight = MeasureSpec.getSize(heightMeasureSpec) - getVerticalPadding();\n  if (maxInternalWidth < 0) {\n    maxInternalWidth = 0;\n  }\n  if (maxInternalHeight < 0) {\n    maxInternalHeight = 0;\n  }\n\n  final List<View> layoutChildren = getLayoutChildren();\n  final List<RowMeasurement> rows = new ArrayList<RowMeasurement>();\n  RowMeasurement currentRow = new RowMeasurement(maxInternalWidth, widthMode);\n  rows.add(currentRow);\n\n  if (layoutChildren != null) {\n    for (final View child : layoutChildren) {\n      if (child == null) {\n        continue;\n      }\n\n      final LayoutParams childLayoutParams = child.getLayoutParams();\n      final int childWidthSpec = createChildMeasureSpec(childLayoutParams.width, maxInternalWidth, widthMode);\n      final int childHeightSpec = createChildMeasureSpec(childLayoutParams.height, maxInternalHeight, heightMode);\n\n      child.measure(childWidthSpec, childHeightSpec);\n\n      final int childWidth = child.getMeasuredWidth();\n      final int childHeight = child.getMeasuredHeight();\n\n      if (currentRow.wouldExceedMax(childWidth)) {\n        currentRow = new RowMeasurement(maxInternalWidth, widthMode);\n        rows.add(currentRow);\n      }\n\n      currentRow.addChildDimensions(childWidth, childHeight);\n    }\n  }\n\n  int longestRowWidth = 0;\n  int totalRowHeight = 0;\n  for (int index = 0; index < rows.size(); index++) {\n    final RowMeasurement row = rows.get(index);\n    totalRowHeight += row.getHeight();\n    if (index < rows.size() - 1) {\n      totalRowHeight += verticalSpacing;\n    }\n    longestRowWidth = Math.max(longestRowWidth, row.getWidth());\n  }\n\n  final int measuredWidth = widthMode == MeasureSpec.EXACTLY\n      ? MeasureSpec.getSize(widthMeasureSpec)\n      : longestRowWidth + getHorizontalPadding();\n\n  final int measuredHeight = heightMode == MeasureSpec.EXACTLY\n      ? MeasureSpec.getSize(heightMeasureSpec)\n      : totalRowHeight + getVerticalPadding();\n\n  setMeasuredDimension(measuredWidth, measuredHeight);\n  currentRows = Collections.unmodifiableList(rows);\n}",
  "explanation": "code_hardening: Added guards for negative internal width/height after padding subtraction, null checks for the child list and individual children, and applied final modifiers to local variables where applicable. Existing GONE-handling is preserved via getLayoutChildren().\nresolve_compilation_errors: Used existing helpers and fields exactly as defined in the codebase (createChildMeasureSpec, RowMeasurement, verticalSpacing, currentRows) and relied on existing MeasureSpec usage consistent with the surrounding file. No new APIs were introduced.\nexception_handling: none.\nlogic_customization: None; measurement logic, row wrapping behavior, MeasureSpec handling, spacing, and setMeasuredDimension behavior remain identical to the original implementation.\nrefactoring: Minor local variable naming and formatting adjustments for clarity and consistency, without changing structure or extracting helpers.\nmisc: Reformatted braces and indentation to align with project style and added minimal defensive checks without altering behavior. New custom API calls: none."
}