{
  "code": "private void load(Context context) {\n    if(context == null) return;\n    if(mIsLoading) return;\n    mIsLoading = true;\n\n    try {\n        Resources res = getResources(context);\n        if(res == null) return;\n\n        SharedPreferences prefs = android.preference.PreferenceManager.getDefaultSharedPreferences(context);\n        boolean useMask = prefs.getBoolean(\"icon_pack_use_mask\", true);\n\n        XmlPullParser xpp = null;\n        int appfilterId = res.getIdentifier(\"appfilter\", \"xml\", packageName);\n        if(appfilterId > 0) {\n            xpp = res.getXml(appfilterId);\n        } else {\n            // Fallback to assets/appfilter.xml\n            try (InputStream is = res.getAssets().open(\"appfilter.xml\")) {\n                XmlPullParserFactory factory = XmlPullParserFactory.newInstance();\n                factory.setNamespaceAware(true);\n                xpp = factory.newPullParser();\n                xpp.setInput(is, \"utf-8\");\n            }\n        }\n\n        if(xpp == null) return;\n\n        int eventType = xpp.getEventType();\n        while(eventType != XmlPullParser.END_DOCUMENT) {\n            if(eventType == XmlPullParser.START_TAG) {\n                String tag = xpp.getName();\n\n                if(useMask && \"iconback\".equals(tag)) {\n                    for(int i = 0; i < xpp.getAttributeCount(); i++) {\n                        String attrName = xpp.getAttributeName(i);\n                        if(attrName != null && attrName.startsWith(\"img\")) {\n                            String drawableName = xpp.getAttributeValue(i);\n                            if(drawableName != null) {\n                                Bitmap bmp = loadBitmap(context, drawableName);\n                                if(bmp != null) mBackImages.add(bmp);\n                            }\n                        }\n                    }\n                } else if(useMask && \"iconmask\".equals(tag)) {\n                    if(xpp.getAttributeCount() > 0 && \"img1\".equals(xpp.getAttributeName(0))) {\n                        String drawableName = xpp.getAttributeValue(0);\n                        if(drawableName != null)\n                            mMaskImage = loadBitmap(context, drawableName);\n                    }\n                } else if(useMask && \"iconupon\".equals(tag)) {\n                    if(xpp.getAttributeCount() > 0 && \"img1\".equals(xpp.getAttributeName(0))) {\n                        String drawableName = xpp.getAttributeValue(0);\n                        if(drawableName != null)\n                            mFrontImage = loadBitmap(context, drawableName);\n                    }\n                } else if(useMask && \"scale\".equals(tag)) {\n                    if(xpp.getAttributeCount() > 0 && \"factor\".equals(xpp.getAttributeName(0))) {\n                        try {\n                            mFactor = Float.valueOf(xpp.getAttributeValue(0));\n                        } catch (NumberFormatException ignored) { }\n                    }\n                } else if(\"item\".equals(tag)) {\n                    String componentName = null;\n                    String drawableName = null;\n\n                    for(int i = 0; i < xpp.getAttributeCount(); i++) {\n                        String attrName = xpp.getAttributeName(i);\n                        if(\"component\".equals(attrName)) {\n                            componentName = xpp.getAttributeValue(i);\n                        } else if(\"drawable\".equals(attrName)) {\n                            drawableName = xpp.getAttributeValue(i);\n                        }\n                    }\n\n                    if(componentName != null && drawableName != null && !mPackagesDrawables.containsKey(componentName)) {\n                        mPackagesDrawables.put(componentName, drawableName);\n                        totalIcons++;\n                    }\n                }\n            }\n            eventType = xpp.next();\n        }\n\n        mLoaded = true;\n    } catch (XmlPullParserException | IOException ignored) {\n        // Graceful failure\n    } finally {\n        mIsLoading = false;\n    }\n}",
  "explanation": "code_hardening: Added a re-entrancy guard using mIsLoading, null checks for Context, Resources, and parsed attributes, ensured InputStream is closed via try-with-resources, and guarded bitmap loading and number parsing to avoid corrupting state.\nresolve_compilation_errors: Changed the signature to private void load(Context context), removed reliance on a member Context, routed resource access through getResources(context), updated loadBitmap calls to pass Context, and used fully qualified PreferenceManager to avoid import assumptions.\nexception_handling: Removed PackageManager.NameNotFoundException handling, merged XML parsing and IO failures into a single XmlPullParserException | IOException catch, ensured mIsLoading is reset in finally, and failed gracefully without throwing.\nlogic_customization: Introduced SharedPreferences flag icon_pack_use_mask to conditionally parse iconback, iconmask, iconupon, and scale while always parsing item mappings; preserved deduplication by component, totalIcons incrementing, and mLoaded behavior; required Context for bitmap loading.\nrefactoring: Made load private, simplified control flow with clearer tag-based conditionals, reduced nested try-catch blocks, and grouped masking logic under the preference flag for readability.\nmisc: Updated inline comments to reflect new behavior and cleaned up formatting; new custom API calls used include android.preference.PreferenceManager.getDefaultSharedPreferences(Context) (absent from the SO snippet)."
}