{
  "code": "public static String reshape_reverse(String Str) {\n        if (Str == null || Str.length() == 0) {\n            return Str;\n        }\n\n        // Extra padding on both ends to allow reverse neighbor access (i+3)\n        String Temp = \"  \" + Str + \"  \";\n        StringBuilder reshapedString = new StringBuilder();\n        int len = Str.length();\n        int i = 0;\n\n        while (i < len) {\n            // Reverse context: preRight = next (right), at = current, postLeft = previous (left)\n            char postLeft = Temp.charAt(i + 1);\n            char at = Temp.charAt(i + 2);\n            char preRight = Temp.charAt(i + 3);\n\n            int which_case = getCase(at);\n            int what_case_preRight = getCase(preRight);\n            int what_case_postLeft = getCase(postLeft);\n\n            // Connectivity now depends on the right-side neighbor\n            int pre_step = 0;\n            if (what_case_preRight == TASHKEEL) {\n                // Skip forward to next base letter when right neighbor is tashkeel\n                if (i + 4 < Temp.length()) {\n                    preRight = Temp.charAt(i + 4);\n                    what_case_preRight = getCase(preRight);\n                }\n            }\n            if ((what_case_preRight & LEFT_CHAR_MASK) == LEFT_CHAR_MASK) {\n                pre_step = 1;\n            }\n\n            switch (which_case & 0x000F) {\n                case NOTUSED_CHAR:\n                case NOTARABIC_CHAR:\n                    reshapedString.append(at);\n                    i++;\n                    continue;\n\n                case NORIGHT_NOLEFT_CHAR:\n                case TATWEEL_CHAR:\n                    reshapedString.append(getShape(at, 0));\n                    i++;\n                    continue;\n\n                case RIGHT_LEFT_CHAR:\n                case RIGHT_LEFT_CHAR_LAM:\n                    // Generic join logic in reverse context\n                    if ((what_case_postLeft & RIGHT_NOLEFT_CHAR_MASK) == RIGHT_NOLEFT_CHAR_MASK) {\n                        reshapedString.append(getShape(at, 2 + pre_step));\n                    } else {\n                        reshapedString.append(getShape(at, pre_step));\n                    }\n                    i++;\n                    continue;\n\n                case RIGHT_NOLEFT_CHAR_ALEF:\n                    // Lam–Alef ligature detection moved here (reverse context)\n                    if ((what_case_postLeft & 0x000F) == RIGHT_LEFT_CHAR_LAM) {\n                        reshapedString.append(getShape(at, pre_step + 2));\n                        i += 2; // consume Lam + Alef\n                        continue;\n                    }\n                    // fall through to default Alef behavior\n                case RIGHT_NOLEFT_CHAR:\n                    reshapedString.append(getShape(at, pre_step));\n                    i++;\n                    continue;\n\n                case TASHKEEL:\n                case TANWEEN:\n                    reshapedString.append(getShape(at, 0));\n                    i++;\n                    continue;\n\n                default:\n                    reshapedString.append(getShape(at, 0));\n                    i++;\n            }\n        }\n\n        return reshapedString.toString();\n    }",
  "explanation": "code_hardening: Added null/empty input guard, expanded Temp padding on both ends, and bounds-checked forward skips when accessing i+4 to safely handle reverse traversal and diacritics.\nresolve_compilation_errors: Renamed the method to reshape_reverse, remapped pre/at/post semantics to reversed neighbors, and reused existing constants and getCase/getShape without introducing new dependencies.\nexception_handling: none.\nlogic_customization: Implemented reversed neighbor interpretation, recalculated connectivity (pre_step) from the right-side neighbor, moved Lam–Alef ligature handling into the RIGHT_NOLEFT_CHAR_ALEF case using the preceding Lam in reverse context, simplified Alef branches, and updated TASHKEEL handling to skip forward to the next base letter.\nrefactoring: Renamed local variables to preRight and postLeft for clarity, grouped RIGHT_LEFT_CHAR_LAM with RIGHT_LEFT_CHAR under generic join logic, and removed obsolete pre_pre usage.\nmisc: Updated inline comments to document reverse shaping behavior and lightly reformatted switch cases for readability. New custom API calls: none."
}