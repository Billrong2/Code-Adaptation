{
  "code": "public void resizeText(int width, int height) {\n        final CharSequence text = getText();\n        if (text == null || text.length() == 0 || width <= 0 || height <= 0 || mTextSize <= 0) {\n            return;\n        }\n\n        final TextPaint basePaint = getPaint();\n        if (basePaint == null) {\n            return;\n        }\n\n        final float oldTextSize = basePaint.getTextSize();\n        final float maxStartSize = mMaxTextSize > 0 ? Math.min(mTextSize, mMaxTextSize) : mTextSize;\n        final float minSize = Math.max(0f, mMinTextSize);\n        final float STEP_PX = 2f;\n\n        float targetTextSize = maxStartSize;\n\n        int textHeight = getTextHeight(text, basePaint, width, targetTextSize);\n\n        while (textHeight > height && targetTextSize > minSize) {\n            targetTextSize = Math.max(targetTextSize - STEP_PX, minSize);\n            textHeight = getTextHeight(text, basePaint, width, targetTextSize);\n            if (targetTextSize == minSize) {\n                break;\n            }\n        }\n\n        if (mAddEllipsis && targetTextSize == minSize && textHeight > height) {\n            TextPaint measurePaint = new TextPaint(basePaint);\n            measurePaint.setTextSize(targetTextSize);\n\n            android.text.StaticLayout layout = new android.text.StaticLayout(\n                    text,\n                    measurePaint,\n                    width,\n                    android.text.Layout.Alignment.ALIGN_NORMAL,\n                    mSpacingMult,\n                    mSpacingAdd,\n                    true\n            );\n\n            final int lineCount = layout.getLineCount();\n            if (lineCount <= 0) {\n                setText(\"\");\n            } else {\n                int lastLine = layout.getLineForVertical(height) - 1;\n                if (lastLine < 0) {\n                    setText(\"\");\n                } else {\n                    lastLine = Math.min(lastLine, lineCount - 1);\n                    int start = layout.getLineStart(lastLine);\n                    int end = layout.getLineEnd(lastLine);\n\n                    float ellipsisWidth = measurePaint.measureText(mEllipsis);\n                    float lineWidth = layout.getLineWidth(lastLine);\n\n                    while (end > start && lineWidth + ellipsisWidth > width) {\n                        end--;\n                        lineWidth = measurePaint.measureText(text.subSequence(start, end).toString());\n                    }\n\n                    if (end > 0) {\n                        setText(text.subSequence(0, end).toString() + mEllipsis);\n                    } else {\n                        setText(\"\");\n                    }\n                }\n            }\n        }\n\n        setTextSize(android.util.TypedValue.COMPLEX_UNIT_PX, targetTextSize);\n        setLineSpacing(mSpacingAdd, mSpacingMult);\n\n        if (mTextResizeListener != null) {\n            mTextResizeListener.onTextResize(this, oldTextSize, targetTextSize);\n        }\n\n        mNeedsResize = false;\n    }",
  "explanation": "code_hardening: Added guards for null/empty text, invalid width/height, missing TextPaint, and non-positive text sizes. Cloned TextPaint for measurement to avoid side effects. Protected ellipsis logic against zero rendered lines and negative last-line indices, clearing text safely when nothing fits. Enforced a minimum text size and a fixed decrement step to prevent infinite loops.\nresolve_compilation_errors: Replaced direct TextPaint text-size mutation for the final application with setTextSize(TypedValue.COMPLEX_UNIT_PX, targetTextSize) to align with TextView APIs. Used fully qualified names for StaticLayout, Layout.Alignment, and TypedValue within the function. Removed any width-based measurement helpers by relying solely on getTextHeight and StaticLayout.\nexception_handling: none.\nlogic_customization: Updated the resize loop to fit by height only, computing height via wrapping constrained by the provided width. Implemented safer ellipsis handling by measuring with a cloned TextPaint, avoiding drawing to a Canvas, trimming to the previous full line, ensuring room for the ellipsis, and clearing text when no line fits at minimum size. Listener notification and line-spacing enforcement remain unchanged.\nrefactoring: Removed redundant width-related checks and calculations. Introduced a named STEP_PX constant for size decrements and clarified variable naming for target vs. original text size. Consolidated measurement logic for clarity within the function.\nmisc: Updated behavior comments implicitly through code structure to reflect height-only fitting and safer measurement. Minor formatting cleanup consistent with existing style. New custom API calls used: android.util.TypedValue#COMPLEX_UNIT_PX via setTextSize(int, float); android.text.StaticLayout constructor with measurement-only usage."
}