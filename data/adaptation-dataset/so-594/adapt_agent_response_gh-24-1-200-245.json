{
  "code": "public static Camera.Size getOptimalPreviewSize(int w, int h) {\n    // Select the optimal preview size from the currently active camera\n    final double ASPECT_TOLERANCE = 0.1;\n\n    if (ManagerCamera.mCamera == null) {\n      return null;\n    }\n\n    android.hardware.Camera.Parameters parameters = ManagerCamera.mCamera.getParameters();\n    if (parameters == null) {\n      return null;\n    }\n\n    java.util.List<android.hardware.Camera.Size> sizes = parameters.getSupportedPreviewSizes();\n    if (sizes == null || sizes.isEmpty()) {\n      return null;\n    }\n\n    double targetRatio = (double) h / (double) w;\n    int targetHeight = h;\n\n    android.hardware.Camera.Size optimalSize = null;\n    double minDiff = Double.MAX_VALUE;\n\n    // First pass: try to find a size matching the aspect ratio within tolerance\n    for (android.hardware.Camera.Size size : sizes) {\n      double ratio = (double) size.width / (double) size.height;\n      if (Math.abs(ratio - targetRatio) > ASPECT_TOLERANCE) {\n        continue;\n      }\n      double heightDiff = Math.abs(size.height - targetHeight);\n      if (heightDiff < minDiff) {\n        optimalSize = size;\n        minDiff = heightDiff;\n      }\n    }\n\n    // Fallback: ignore aspect ratio, choose closest height\n    if (optimalSize == null) {\n      minDiff = Double.MAX_VALUE;\n      for (android.hardware.Camera.Size size : sizes) {\n        double heightDiff = Math.abs(size.height - targetHeight);\n        if (heightDiff < minDiff) {\n          optimalSize = size;\n          minDiff = heightDiff;\n        }\n      }\n    }\n\n    return optimalSize;\n  }",
  "explanation": "code_hardening: Added early null checks for ManagerCamera.mCamera, its Parameters, and the supported preview size list, returning null when any prerequisite is unavailable. Kept ASPECT_TOLERANCE as a final constant and guarded against empty size lists.\nresolve_compilation_errors: Converted the helper into a public static method and removed the sizes parameter. Replaced it with a locally fetched List from ManagerCamera.mCamera.getParameters().getSupportedPreviewSizes(), using fully qualified types where necessary to avoid import issues.\nexception_handling: none.\nlogic_customization: Updated the data source for preview sizes to come from the active camera parameters while preserving the original aspect-ratio tolerance and height-based selection logic, including the fallback behavior.\nrefactoring: Adjusted method scope and signature to act as a static utility on ManagerCamera and performed minor variable naming and structural cleanup for clarity without altering the algorithm.\nmisc: Added brief inline comments documenting the two-pass selection strategy and the assumption that the active camera is already initialized. New custom API calls used: android.hardware.Camera.Parameters#getSupportedPreviewSizes()."}