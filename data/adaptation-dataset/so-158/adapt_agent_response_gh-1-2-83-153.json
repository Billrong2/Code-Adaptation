{
  "code": "@Override\nprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n    // First pass: let ViewPager measure itself\n    super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n\n    final boolean isWrapContentHeight = View.MeasureSpec.getMode(heightMeasureSpec) == View.MeasureSpec.AT_MOST;\n\n    // Validate required state\n    if (getChildCount() <= 0 || datesInMonth == null || datesInMonth.isEmpty()) {\n        // Nothing meaningful to measure against; keep the measured dimensions\n        return;\n    }\n\n    final int measuredWidth = getMeasuredWidth();\n    final int exactWidthSpec = View.MeasureSpec.makeMeasureSpec(measuredWidth, View.MeasureSpec.EXACTLY);\n\n    // Constants used for calendar calculations\n    final int DAYS_IN_WEEK = 7;\n    final int EXTRA_HEIGHT_OFFSET = 3;\n\n    // Derive number of rows from data\n    int rows = datesInMonth.size() / DAYS_IN_WEEK;\n    if (rows <= 0) {\n        rows = 1; // hard guard against division by zero\n    }\n\n    if (sixWeeksInCalendar) {\n        rows = 6;\n    }\n\n    // Compute and cache rowHeight on first wrap-content measurement\n    if (rowHeight <= 0 && isWrapContentHeight) {\n        View firstChild = getChildAt(0);\n        if (firstChild != null) {\n            // Allow the child to wrap so we can infer a per-row height\n            firstChild.measure(exactWidthSpec,\n                    View.MeasureSpec.makeMeasureSpec(getMeasuredHeight(), View.MeasureSpec.AT_MOST));\n\n            int childHeight = firstChild.getMeasuredHeight();\n            if (childHeight > 0 && rows > 0) {\n                rowHeight = childHeight / rows;\n            }\n        }\n    }\n\n    // Fallback if rowHeight is still invalid\n    if (rowHeight <= 0) {\n        rowHeight = getMeasuredHeight() / rows;\n    }\n\n    // Final calendar-specific height\n    int calendarHeight = (rowHeight * rows) + EXTRA_HEIGHT_OFFSET;\n\n    int exactHeightSpec = View.MeasureSpec.makeMeasureSpec(calendarHeight, View.MeasureSpec.EXACTLY);\n\n    // Always remeasure with exact calendar height\n    super.onMeasure(exactWidthSpec, exactHeightSpec);\n}",
  "explanation": "code_hardening: Added guards for null/empty datesInMonth, no children, invalid row counts, and invalid cached rowHeight; protected against division by zero and ensured a safe fallback height.\nresolve_compilation_errors: Used existing persistent fields (rowHeight, datesInMonth, sixWeeksInCalendar) and fully qualified View.MeasureSpec to avoid import issues; relied only on types already present in the class.\nexception_handling: none.\nlogic_customization: Replaced first-child-wrap logic with calendar-specific height computation; derived rows from datesInMonth.size()/7, forced six rows when sixWeeksInCalendar is true, computed and cached per-row height on the first wrap-content measurement, added a +3 offset, and always performed a second measurement with EXACT height.\nrefactoring: Renamed local variables for clarity (e.g., isWrapContentHeight), introduced named constants for days-per-week and extra offset, and simplified width handling for remeasurement.\nmisc: Updated inline comments to describe calendar-specific measurement behavior; no new custom API calls were introduced."
}