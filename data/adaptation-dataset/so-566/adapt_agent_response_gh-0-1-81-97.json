{
  "code": "@Override\n  public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws ServletException, IOException {\n    if (!(request instanceof HttpServletRequest)) {\n      chain.doFilter(request, response);\n      return;\n    }\n\n    final HttpServletRequest hsr = (HttpServletRequest) request;\n    final ServletFilter[] filtersArray = this.filters;\n\n    // Short-circuit when no filters are configured\n    if (filtersArray == null || filtersArray.length == 0) {\n      chain.doFilter(hsr, response);\n      return;\n    }\n\n    final String requestUri = hsr.getRequestURI();\n    final String contextPath = hsr.getContextPath();\n    final String path;\n    if (requestUri == null) {\n      path = \"\";\n    } else if (contextPath != null && !contextPath.isEmpty()) {\n      path = requestUri.replaceFirst(contextPath, \"\");\n    } else {\n      path = requestUri;\n    }\n\n    final GodFilterChain godChain = new GodFilterChain(chain);\n\n    for (ServletFilter filter : filtersArray) {\n      if (filter == null) {\n        continue;\n      }\n      java.util.regex.Pattern pattern = filter.doGetPattern();\n      if (pattern != null && pattern.matcher(path).matches()) {\n        godChain.addFilter(filter);\n      }\n    }\n\n    // Delegate through GodFilterChain (it will fall back to the original chain if no filter matched)\n    godChain.doFilter(hsr, response);\n  }",
  "explanation": "code_hardening: Added guards for non-HttpServletRequest inputs, null/empty filter array, null request URI, null context path, and null elements within the filter array; used final locals for key variables.\nresolve_compilation_errors: Replaced Map-based iteration with ordered iteration over ServletFilter[]; removed Entry usage; obtained match Pattern via filter.doGetPattern(); ensured doFilter invocations use HttpServletRequest; referenced java.util.regex.Pattern explicitly where needed.\nexception_handling: Preserved the existing throws ServletException, IOException contract and ensured all new branches delegate while propagating exceptions unchanged.\nlogic_customization: Computed the request path using replaceFirst(contextPath, \"\") instead of substring; short-circuited directly to the original FilterChain when no filters are configured; added only filters whose pattern matches the computed path; ensured GodFilterChain delegates to the original chain when none match; consistently passed the HttpServletRequest instance (hsr) downstream.\nrefactoring: Renamed locals to reflect array-based processing (filtersArray) and simplified the loop to respect array order.\nmisc: Used minimal in-method comments consistent with existing style; no new custom API calls beyond existing project types (org.sonar.api.web.ServletFilter, MasterServletFilter.GodFilterChain)."}