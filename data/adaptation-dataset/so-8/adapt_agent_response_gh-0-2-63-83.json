{
  "code": "@Override\nprotected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n\t// Aspect-ratio-preserving measurement for ImageView.\n\t// One dimension is auto-fitted based on the other while keeping the drawable's intrinsic ratio.\n\t// Adapted from a common Stack Overflow solution discussing ImageView auto-fit behavior.\n\n\tDrawable drawable = getDrawable();\n\n\t// If there is no drawable, or we cannot safely determine its size, defer to default behavior.\n\tif (drawable == null) {\n\t\tsuper.onMeasure(widthMeasureSpec, heightMeasureSpec);\n\t\treturn;\n\t}\n\n\tint intrinsicWidth = drawable.getIntrinsicWidth();\n\tint intrinsicHeight = drawable.getIntrinsicHeight();\n\n\t// Guard against invalid intrinsic sizes to avoid divide-by-zero.\n\tif (intrinsicWidth <= 0 || intrinsicHeight <= 0) {\n\t\tsuper.onMeasure(widthMeasureSpec, heightMeasureSpec);\n\t\treturn;\n\t}\n\n\tint width = android.view.View.MeasureSpec.getSize(widthMeasureSpec);\n\tint height = android.view.View.MeasureSpec.getSize(heightMeasureSpec);\n\n\t// Preserve aspect ratio by scaling the smaller-constrained dimension.\n\tif (width >= height && height > 0) {\n\t\theight = (int) Math.ceil(width * (float) intrinsicHeight / intrinsicWidth);\n\t} else if (width > 0) {\n\t\twidth = (int) Math.ceil(height * (float) intrinsicWidth / intrinsicHeight);\n\t}\n\n\tsetMeasuredDimension(width, height);\n}",
  "explanation": "code_hardening: Added checks for null drawable and for non-positive intrinsic width/height to avoid divide-by-zero; also guarded basic dimension usage before calculations and deferred to super.onMeasure when unsafe.\nresolve_compilation_errors: Used fully qualified android.view.View.MeasureSpec inside the function to avoid relying on unseen imports; confirmed compatibility with ImageView's getDrawable(), setMeasuredDimension(), and super.onMeasure(). No new custom APIs were introduced.\nexception_handling: none.\nlogic_customization: Preserved the original aspect-ratio measurement logic exactly, only adding validation gates before performing calculations; behavior remains unchanged when inputs are valid.\nrefactoring: Removed all final modifiers, used implicit this for method calls, reordered and clarified local variable declarations (intrinsic sizes first, then measured sizes) without altering semantics.\nmisc: Added concise explanatory comments describing the auto-fit aspect-ratio behavior and referenced the Stack Overflow origin; applied minor formatting consistent with Android view code style. No new custom API calls were added."
}