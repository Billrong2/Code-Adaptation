{
  "code": "/**\n     * Computes the appropriate screen orientation constant for the given activity\n     * without applying any side effects.\n     * <p>\n     * This preserves the original logic used to determine the device natural\n     * orientation and maps the current display rotation to the corresponding\n     * {@link android.content.pm.ActivityInfo} constant.\n     * <p>\n     * Source logic adapted from a Stack Overflow answer about locking screen\n     * orientation based on natural device orientation.\n     *\n     * @param activity the activity used to retrieve configuration and display data\n     * @return one of {@link ActivityInfo} SCREEN_ORIENTATION_* constants, or\n     * {@link ActivityInfo#SCREEN_ORIENTATION_UNSPECIFIED} as a safe fallback\n     */\n    public static int getScreenOrientation(Activity activity) {\n        if (activity == null) {\n            return ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED;\n        }\n\n        WindowManager windowManager = (WindowManager) activity.getSystemService(Context.WINDOW_SERVICE);\n        if (windowManager == null || windowManager.getDefaultDisplay() == null) {\n            return ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED;\n        }\n\n        Configuration configuration = activity.getResources() != null\n            ? activity.getResources().getConfiguration()\n            : null;\n        if (configuration == null) {\n            return ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED;\n        }\n\n        int rotation = windowManager.getDefaultDisplay().getRotation();\n\n        // Determine the natural orientation of the device\n        boolean naturalLandscape =\n            (configuration.orientation == Configuration.ORIENTATION_LANDSCAPE &&\n                (rotation == Surface.ROTATION_0 || rotation == Surface.ROTATION_180)) ||\n            (configuration.orientation == Configuration.ORIENTATION_PORTRAIT &&\n                (rotation == Surface.ROTATION_90 || rotation == Surface.ROTATION_270));\n\n        if (naturalLandscape) {\n            // Natural position is landscape\n            switch (rotation) {\n                case Surface.ROTATION_0:\n                    return ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE;\n                case Surface.ROTATION_90:\n                    return ActivityInfo.SCREEN_ORIENTATION_REVERSE_PORTRAIT;\n                case Surface.ROTATION_180:\n                    return ActivityInfo.SCREEN_ORIENTATION_REVERSE_LANDSCAPE;\n                case Surface.ROTATION_270:\n                    return ActivityInfo.SCREEN_ORIENTATION_PORTRAIT;\n                default:\n                    return ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED;\n            }\n        }\n        else {\n            // Natural position is portrait\n            switch (rotation) {\n                case Surface.ROTATION_0:\n                    return ActivityInfo.SCREEN_ORIENTATION_PORTRAIT;\n                case Surface.ROTATION_90:\n                    return ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE;\n                case Surface.ROTATION_180:\n                    return ActivityInfo.SCREEN_ORIENTATION_REVERSE_PORTRAIT;\n                case Surface.ROTATION_270:\n                    return ActivityInfo.SCREEN_ORIENTATION_REVERSE_LANDSCAPE;\n                default:\n                    return ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED;\n            }\n        }\n    }",
  "explanation": "code_hardening: Added null checks for Activity, WindowManager, Display, Resources, and Configuration, and ensured a safe fallback by returning ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED when data is unavailable or no case matches.\nresolve_compilation_errors: none.\nexception_handling: none; the method avoids throwing and relies on defensive checks.\nlogic_customization: Replaced all side effects (setRequestedOrientation) with returning the corresponding ActivityInfo.SCREEN_ORIENTATION_* constants while preserving the original natural-orientation and rotation-mapping logic.\nrefactoring: Renamed the method to getScreenOrientation, changed the return type to int, kept it static as a pure utility, and simplified control flow so every path returns a value.\nmisc: Added concise Javadoc documenting purpose, behavior, and source reference; applied minor formatting for readability. No new custom API calls were introduced beyond those already present in the snippet (android.view.WindowManager, android.view.Surface, android.content.pm.ActivityInfo)."
}