{
  "code": "@Override\npublic boolean onKeyDown(int keyCode, android.view.KeyEvent event) {\n    if (keyCode == android.view.KeyEvent.KEYCODE_BACK) {\n        // Only intercept back press at the task root\n        if (!isTaskRoot()) {\n            return super.onKeyDown(keyCode, event);\n        }\n\n        // Respect user preference for confirm quit/logout\n        if (!mSettings.isConfirmQuitOrLogout()) {\n            return super.onKeyDown(keyCode, event);\n        }\n\n        // Avoid showing dialogs when activity is no longer valid\n        if (isFinishing() || (android.os.Build.VERSION.SDK_INT >= 17 && isDestroyed())) {\n            return super.onKeyDown(keyCode, event);\n        }\n\n        // Show themed confirmation dialog\n        new android.app.AlertDialog.Builder(\n                new android.view.ContextThemeWrapper(this, mSettings.getDialogTheme()))\n                .setIcon(android.R.drawable.ic_dialog_alert)\n                .setTitle(com.andrewshu.android.reddit.R.string.quit)\n                .setMessage(com.andrewshu.android.reddit.R.string.really_quit)\n                .setPositiveButton(com.andrewshu.android.reddit.R.string.yes,\n                        new android.content.DialogInterface.OnClickListener() {\n                            @Override\n                            public void onClick(android.content.DialogInterface dialog, int which) {\n                                // Finish this activity\n                                finish();\n                            }\n                        })\n                .setNegativeButton(com.andrewshu.android.reddit.R.string.no, null)\n                .show();\n\n        return true;\n    }\n\n    return super.onKeyDown(keyCode, event);\n}",
  "explanation": "code_hardening: Added guards to ensure the activity is the task root, the confirm-quit preference is enabled, and the activity is not finishing or destroyed before showing a dialog.\nresolve_compilation_errors: Replaced the invalid YourClass.this.finish() with finish(); used fully qualified names for Android framework classes and R resources to avoid import ambiguity.\nexception_handling: none.\nlogic_customization: Integrated user preference checking via mSettings.isConfirmQuitOrLogout(); ensured back-press interception only occurs when isTaskRoot() is true; applied a themed dialog using ContextThemeWrapper with mSettings.getDialogTheme(); delegated to super.onKeyDown when conditions are not met.\nrefactoring: Simplified the finish call to finish(); streamlined conditional flow to return early and preserve default behavior.\nmisc: Updated comments to reflect conditional quit confirmation behavior; kept formatting consistent with existing project style."
}