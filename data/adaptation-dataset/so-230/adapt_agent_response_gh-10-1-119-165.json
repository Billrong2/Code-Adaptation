{
  "code": "/**\n   * For the given {@code url}, extract a mapping of query parameter names to values.\n   * <p>\n   * The query portion is defined as the substring after the first {@code '?'} character. Parameters are split on\n   * {@code '&'} and key/value pairs are split on {@code '='}. Both keys and values are URL-decoded using\n   * {@value #ENCODING_CHARSET}. If a parameter appears multiple times, all values are aggregated (in encounter order)\n   * under the same key. If a parameter has no explicit value (e.g. {@code flag}), its value defaults to an empty\n   * string.\n   * <p>\n   * Edge cases:\n   * <ul>\n   *   <li>If {@code url} is {@code null}, an empty {@code Map} is returned.</li>\n   *   <li>If no query portion exists, an empty {@code Map} is returned.</li>\n   *   <li>Malformed or empty parameter segments are safely ignored.</li>\n   * </ul>\n   *\n   * @param url\n   *          The full URL from which query parameters are extracted.\n   * @return A mapping of query parameter names to their values; never {@code null}.\n   * @throws IllegalStateException\n   *           If unable to URL-decode because the JVM doesn't support {@value #ENCODING_CHARSET}.\n   */\n  public static Map<String, List<String>> extractParametersFromUrl(String url) {\n    if (url == null) {\n      return emptyMap();\n    }\n\n    final int questionMarkIndex = url.indexOf('?');\n    if (questionMarkIndex < 0 || questionMarkIndex == url.length() - 1) {\n      return emptyMap();\n    }\n\n    final Map<String, List<String>> parameters = new HashMap<String, List<String>>();\n    final String query = url.substring(questionMarkIndex + 1);\n\n    for (final String segment : query.split(\"&\")) {\n      if (segment == null || segment.length() == 0) {\n        continue;\n      }\n\n      final String[] pair = segment.split(\"=\", 2);\n      if (pair.length == 0 || pair[0].length() == 0) {\n        continue;\n      }\n\n      final String key = urlDecode(pair[0]);\n      final String value = pair.length > 1 ? urlDecode(pair[1]) : \"\";\n\n      List<String> values = parameters.get(key);\n      if (values == null) {\n        values = new ArrayList<String>();\n        parameters.put(key, values);\n      }\n      values.add(value);\n    }\n\n    return parameters;\n  }",
  "explanation": "code_hardening: Added a null check for the url input returning an empty map, guarded against missing or empty query portions, ignored empty/malformed segments, and used final for local variables where appropriate.\nresolve_compilation_errors: Renamed the API to extractParametersFromUrl and aligned usage with existing callers; replaced inline URLDecoder usage with the existing helper urlDecode(String) and relied on ENCODING_CHARSET via that helper.\nexception_handling: Removed checked exceptions from the signature and delegated decoding failures to urlDecode, which rethrows as an unchecked IllegalStateException.\nlogic_customization: Preserved the original parsing behavior (split on '?', '&', and '=', aggregate multiple values, default missing values to empty string) while centralizing decoding through urlDecode.\nrefactoring: Improved naming (params â†’ parameters), limited split on '=' to two parts, and added comprehensive Javadoc documenting behavior and edge cases.\nmisc: Reformatted code for readability and consistency; new custom API calls used: com.restfb.util.UrlUtils.urlDecode(String) (centralized decoding helper)."}