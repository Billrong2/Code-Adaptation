{
  "code": "@TargetApi(Build.VERSION_CODES.JELLY_BEAN_MR1)\npublic static Bitmap blur(Context context, Bitmap image, int targetWidth, int targetHeight, float blurRadius) {\n    if (context == null || image == null) {\n        return null;\n    }\n    if (targetWidth <= 0 || targetHeight <= 0) {\n        return null;\n    }\n    // RenderScript blur radius must be > 0 and <= 25\n    if (blurRadius <= 0f) {\n        return null;\n    }\n    if (blurRadius > 25f) {\n        blurRadius = 25f;\n    }\n\n    Bitmap scaledBitmap = Bitmap.createScaledBitmap(image, targetWidth, targetHeight, false);\n    Bitmap outputBitmap = Bitmap.createBitmap(scaledBitmap);\n\n    RenderScript rs = null;\n    Allocation inAllocation = null;\n    Allocation outAllocation = null;\n    ScriptIntrinsicBlur blurScript = null;\n\n    try {\n        rs = RenderScript.create(context);\n        blurScript = ScriptIntrinsicBlur.create(rs, Element.U8_4(rs));\n        inAllocation = Allocation.createFromBitmap(rs, scaledBitmap);\n        outAllocation = Allocation.createFromBitmap(rs, outputBitmap);\n\n        blurScript.setRadius(blurRadius);\n        blurScript.setInput(inAllocation);\n        blurScript.forEach(outAllocation);\n        outAllocation.copyTo(outputBitmap);\n\n        return outputBitmap;\n    } finally {\n        if (blurScript != null) {\n            blurScript.destroy();\n        }\n        if (inAllocation != null) {\n            inAllocation.destroy();\n        }\n        if (outAllocation != null) {\n            outAllocation.destroy();\n        }\n        if (rs != null) {\n            rs.destroy();\n        }\n    }\n}",
  "explanation": "code_hardening: Added null checks for context and image, validated targetWidth/targetHeight to be positive, enforced RenderScript blur radius constraints (clamping to 25f), and ensured all RenderScript-related resources are explicitly destroyed in a finally block.\nresolve_compilation_errors: Updated the method signature to accept targetWidth, targetHeight, and blurRadius parameters; removed any dependency on undefined BITMAP_SCALE and BLUR_RADIUS constants; updated the API annotation to @TargetApi(Build.VERSION_CODES.JELLY_BEAN_MR1) using existing project imports.\nexception_handling: Wrapped the RenderScript setup and execution in a try/finally block to guarantee cleanup of RenderScript, Allocation, and ScriptIntrinsicBlur resources even if a runtime exception occurs.\nlogic_customization: Replaced implicit scaling with explicit scaling to the caller-provided targetWidth and targetHeight, and passed the provided blurRadius directly to ScriptIntrinsicBlur.setRadius while keeping the original RenderScript blur pipeline intact.\nrefactoring: Renamed parameters and locals for clarity (context, image, scaledBitmap, outputBitmap) and simplified the flow to focus on a single responsibility: configurable bitmap blurring.\nmisc: Updated inline comments to document parameter constraints and RenderScript behavior; no new custom API calls beyond android.renderscript.RenderScript, Allocation, and ScriptIntrinsicBlur already used in the SO snippet."
}