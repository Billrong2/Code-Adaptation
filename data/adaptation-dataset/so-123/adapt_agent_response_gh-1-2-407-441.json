{
  "code": "    /**\n     * Truncates a string so that its UTF-8 encoded byte length does not exceed the given limit.\n     * <p>\n     * Adapted from a Stack Overflow answer (SO ID: TODO).\n     * </p>\n     */\n    private static String truncateWhenUTF8(final String s, final int maxBytes)\n    {\n        int bytesUsed = 0;\n\n        for (int i = 0; i < s.length(); i++)\n        {\n            final char c = s.charAt(i);\n\n            // Ranges from http://en.wikipedia.org/wiki/UTF-8\n            int skip = 0;\n            final int more;\n\n            if (c <= 0x007f)\n            {\n                more = 1;\n            }\n            else if (c <= 0x07FF)\n            {\n                more = 2;\n            }\n            else if (c <= 0xd7ff)\n            {\n                more = 3;\n            }\n            else if (c <= 0xDFFF)\n            {\n                // Surrogate area, consume next char as well\n                more = 4;\n                skip = 1;\n            }\n            else\n            {\n                more = 3;\n            }\n\n            if (bytesUsed + more > maxBytes)\n            {\n                return s.substring(0, i);\n            }\n\n            bytesUsed += more;\n            i += skip;\n        }\n\n        return s;\n    }",
  "explanation": "code_hardening: none\nresolve_compilation_errors: none\nexception_handling: none\nlogic_customization: none\nrefactoring: Applied purely cosmetic refactoring only: normalized indentation and brace placement to match the surrounding project style, improved local variable naming for readability, and marked parameters and locals as final where non-behavioral. The UTF-8 truncation logic and control flow remain identical.\nmisc: Added a method-level Javadoc comment attributing the original Stack Overflow source (SO ID placeholder) as requested; no new APIs were introduced."
}