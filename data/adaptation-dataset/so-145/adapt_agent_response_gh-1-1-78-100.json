{
  "code": "private TouchableUrlSpan getTouchedSpan(TextView textView, Spannable spannable, MotionEvent event) {\n        if (textView == null || spannable == null || event == null) return null;\n        final Layout layout = textView.getLayout();\n        if (layout == null) return null;\n\n        // Adjust touch coordinates for padding and scroll\n        int x = (int) event.getX();\n        int y = (int) event.getY();\n        x -= textView.getTotalPaddingLeft();\n        y -= textView.getTotalPaddingTop();\n        x += textView.getScrollX();\n        y += textView.getScrollY();\n\n        // Map coordinates to line and character offset\n        int line = layout.getLineForVertical(y);\n        if (line < 0 || line >= layout.getLineCount()) return null;\n        int offset = layout.getOffsetForHorizontal(line, x);\n        if (offset < 0 || offset >= spannable.length()) return null;\n\n        // Find the first TouchableUrlSpan at the offset\n        TouchableUrlSpan[] spans = spannable.getSpans(offset, offset, TouchableUrlSpan.class);\n        if (spans == null || spans.length == 0) return null;\n        return spans[0];\n    }",
  "explanation": "code_hardening: Added null checks for TextView, Spannable, MotionEvent, and Layout; validated line index and character offset bounds; safely returned null when no spans are found.\nresolve_compilation_errors: Removed any dependency on pressed-span state, Selection, and super.onTouchEvent; updated the method to return TouchableUrlSpan directly; used existing project types (TextView, Spannable, MotionEvent, Layout, TouchableUrlSpan) without introducing unresolved references.\nexception_handling: none.\nlogic_customization: Replaced action-based touch handling with unified logic that always resolves the touched span; computed adjusted X/Y using event coordinates, TextView padding, and scroll offsets; used TextView.getLayout() to map coordinates to line and character offset; queried spans at the offset and returned the first TouchableUrlSpan or null.\nrefactoring: Renamed the helper to reflect its responsibility (getTouchedSpan); structured the code into clear steps for coordinate adjustment, offset calculation, and span lookup; kept the method stateless.\nmisc: Updated inline comments to describe the simplified behavior; formatting follows typical Android style. No new custom API calls were introduced beyond in.uncod.android.bypass.style.TouchableUrlSpan (existing in the project)."
}