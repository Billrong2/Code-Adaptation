{
  "code": "/**\n         * Calculates the optimal camera preview size based on the supplied width and height.\n         * <p>\n         * This method preserves the original aspect-ratio matching logic while adapting it to\n         * {@link android.hardware.Camera.Size}. It is derived from a Stack Overflow example and\n         * lightly hardened for null/empty inputs.\n         * </p>\n         *\n         * @param sizes  list of supported camera preview sizes\n         * @param width  target width of the preview surface\n         * @param height target height of the preview surface\n         * @return the optimal {@link android.hardware.Camera.Size}, or a safe fallback if none match\n         *\n         * Source / Credit: http://stackoverflow.com/questions/7942378/android-camera-will-not-work-startpreview-fails\n         */\n        private Camera.Size getOptimalPreviewSize(final List<Camera.Size> sizes, final int width, final int height) {\n            if (sizes == null || sizes.isEmpty() || width <= 0 || height <= 0) {\n                return null;\n            }\n\n            Camera.Size optimalSize = null;\n\n            // Aspect ratio tolerance used by the original algorithm\n            final double ASPECT_TOLERANCE = 0.1d;\n            final double targetRatio = (double) height / (double) width;\n\n            // Try to find a size match which suits the whole screen minus the menu on the left.\n            for (final Camera.Size size : sizes) {\n                if (size == null) {\n                    continue;\n                }\n                // Preserve original comparison logic\n                if (size.height != width) {\n                    continue;\n                }\n                final double ratio = (double) size.width / (double) size.height;\n                if (ratio <= targetRatio + ASPECT_TOLERANCE && ratio >= targetRatio - ASPECT_TOLERANCE) {\n                    optimalSize = size;\n                }\n            }\n\n            // Fallback: if no size matched the aspect ratio criteria, choose the first available size\n            if (optimalSize == null) {\n                optimalSize = sizes.get(0);\n            }\n\n            return optimalSize;\n        }",
  "explanation": "code_hardening: Added null and empty checks for the sizes list and basic validation for width/height; ensured loop guards against null entries; implemented a safe fallback when no optimal size is found.\nresolve_compilation_errors: Replaced generic Size with android.hardware.Camera.Size in the return type, parameters, and loop variable, matching the existing mSupportedPreviewSizes field and onMeasure caller.\nexception_handling: none\nlogic_customization: Kept the original aspect-ratio selection logic unchanged and documented a minimal fallback strategy without altering primary behavior.\nrefactoring: Marked parameters and locals as final where appropriate, introduced a named ASPECT_TOLERANCE constant, improved formatting, and added comprehensive Javadoc.\nmisc: Added source attribution to the original Stack Overflow example and aligned comments/style with the surrounding project; no new custom API calls were introduced."
}