{
  "code": "private void refitText(String text, int textWidth) {\n        // Defensive checks\n        if (text == null || mTestPaint == null || this.getPaint() == null) {\n            return;\n        }\n        if (textWidth <= 0) {\n            return;\n        }\n\n        final int paddingLeft = this.getPaddingLeft();\n        final int paddingRight = this.getPaddingRight();\n        final int targetWidth = textWidth - paddingLeft - paddingRight;\n        if (targetWidth <= 0) {\n            return;\n        }\n\n        // Constants (pixels)\n        final float MAX_TEXT_SIZE_PX = 100f;\n        final float MIN_TEXT_SIZE_PX = 2f;\n        final float SIZE_THRESHOLD_PX = 0.5f; // How close we have to be\n\n        float maxSize = MAX_TEXT_SIZE_PX;\n        float minSize = MIN_TEXT_SIZE_PX;\n\n        // Initialize test paint from the view's paint\n        mTestPaint.set(this.getPaint());\n\n        // Binary search for best text size\n        while ((maxSize - minSize) > SIZE_THRESHOLD_PX) {\n            float testSize = (maxSize + minSize) / 2f;\n            mTestPaint.setTextSize(testSize);\n\n            if (mTestPaint.measureText(text) >= targetWidth) {\n                maxSize = testSize; // too big\n            } else {\n                minSize = testSize; // too small\n            }\n        }\n\n        // Use minSize so that we undershoot rather than overshoot\n        this.setTextSize(TypedValue.COMPLEX_UNIT_PX, minSize);\n    }",
  "explanation": "code_hardening: Added null checks for text, mTestPaint, and getPaint(), guarded against non-positive textWidth and targetWidth after padding subtraction, and constrained sizes using named min/max constants.\nresolve_compilation_errors: Preserved the existing refitText signature used by callers, relied on the existing mTestPaint field and TextView APIs (getPaint, getPaddingLeft/Right, setTextSize) with fully qualified TypedValue usage as already present.\nexception_handling: none.\nlogic_customization: Set mTestPaint.setTextSize(testSize) before each measureText call so measurements reflect the current trial size; removed any TransformationMethod usage so text is measured as provided; kept padding-inclusive width calculation, binary search bounds/threshold, and final undershoot behavior unchanged.\nrefactoring: Replaced magic numbers with named constants, renamed hi/lo to maxSize/minSize for clarity, and slightly reorganized locals for readability within the single function.\nmisc: Added brief inline comments noting units (pixels) and intent; formatting aligned with standard Android/Java style. New custom API calls: none."
}