{
  "code": "private void refitText(String text, int textWidth) {\n    // Constants\n    final float MIN_TEXT_SIZE_PX = 10f;\n    final float SIZE_THRESHOLD_PX = 0.5f;\n\n    if (text == null || text.length() == 0) return;\n    if (textWidth <= 0) return;\n    if (mTestPaint == null || getPaint() == null) return;\n\n    int targetWidth = textWidth - getPaddingLeft() - getPaddingRight();\n    if (targetWidth <= 0) return;\n\n    // Prepare test paint\n    mTestPaint.set(getPaint());\n\n    float upperBound = maxTextSize > 0 ? maxTextSize : getTextSize();\n    float lowerBound = MIN_TEXT_SIZE_PX;\n\n    // Clamp bounds\n    if (upperBound < lowerBound) upperBound = lowerBound;\n\n    // Binary search for best size\n    while ((upperBound - lowerBound) > SIZE_THRESHOLD_PX) {\n        float candidateSize = (upperBound + lowerBound) / 2f;\n        if (candidateSize <= 0) {\n            lowerBound = MIN_TEXT_SIZE_PX;\n            break;\n        }\n        mTestPaint.setTextSize(candidateSize);\n        float measuredWidth = mTestPaint.measureText(text);\n        if (measuredWidth >= targetWidth) {\n            upperBound = candidateSize; // too big\n        } else {\n            lowerBound = candidateSize; // too small\n        }\n    }\n\n    float finalSize = Math.max(MIN_TEXT_SIZE_PX, lowerBound);\n    // Apply via superclass to bypass overridden setters\n    super.setTextSize(TypedValue.COMPLEX_UNIT_PX, finalSize);\n}",
  "explanation": "code_hardening: Added null/empty checks for text, ensured mTestPaint and getPaint() are non-null, guarded against non-positive targetWidth after padding subtraction, and clamped text size bounds to positive values before applying.\nresolve_compilation_errors: Used existing class fields mTestPaint and maxTextSize, referenced TypedValue.COMPLEX_UNIT_PX which is already imported in the file, and explicitly called super.setTextSize to avoid overridden setters.\nexception_handling: none.\nlogic_customization: Removed use of TransformationMethod and measured the raw input text; replaced fixed binary-search bounds with dynamic bounds using maxTextSize as the upper bound and 10px as the lower bound; set the candidate text size on mTestPaint during each binary-search iteration before measuring; applied the final computed size via super.setTextSize(TypedValue.COMPLEX_UNIT_PX, finalSize).\nrefactoring: Replaced magic numbers with named constants (MIN_TEXT_SIZE_PX, SIZE_THRESHOLD_PX), renamed bounds to upperBound/lowerBound for clarity, and simplified control flow within a single readable method.\nmisc: Updated inline comments to reflect raw-text measurement, dynamic bounds, and the need to bypass overridden setTextSize methods; formatting aligns with existing project style."
}