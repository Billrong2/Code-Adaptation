{
  "code": "private static <A extends CharacterStyle, B extends CharacterStyle> Spannable replaceAll(final CharSequence original, final Class<A> sourceType, final SpanConverter<A, B> converter) {\n        if (original == null) {\n            return null;\n        }\n        if (sourceType == null || converter == null) {\n            return new SpannableString(original);\n        }\n\n        final SpannableString result = new SpannableString(original);\n\n        if (!(original instanceof android.text.Spanned)) {\n            return result;\n        }\n\n        A[] spans = result.getSpans(0, result.length(), sourceType);\n        if (spans == null || spans.length == 0) {\n            return result;\n        }\n\n        for (A span : spans) {\n            int start = result.getSpanStart(span);\n            int end = result.getSpanEnd(span);\n            int flags = result.getSpanFlags(span);\n\n            result.removeSpan(span);\n            B converted = converter.convert(span);\n            if (converted != null && start >= 0 && end >= start) {\n                result.setSpan(converted, start, end, flags);\n            }\n        }\n\n        return result;\n    }",
  "explanation": "code_hardening: Added null checks for original, sourceType, and converter; safely return a SpannableString when inputs are insufficient; validated span ranges and converted span before setting; used final parameters for immutability.\nresolve_compilation_errors: Updated the method signature to accept CharSequence instead of Spanned; guarded span operations with an instanceof android.text.Spanned check; retained existing generic bounds and Android text types.\nexception_handling: none.\nlogic_customization: Preserved original behavior for spanned inputs by finding, removing, and replacing spans with identical ranges and flags; for non-spanned inputs, skipped span processing and returned unchanged text wrapped in a SpannableString.\nrefactoring: Renamed locals for clarity (result, converted); structured early returns to simplify control flow.\nmisc: Updated behavior implicitly documents broader CharSequence support; no new custom API calls were introduced (none)."
}