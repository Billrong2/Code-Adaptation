{
  "code": "public BOMStripperInputStream(final InputStream inputStream) throws NullPointerException, IOException\n{\n  if (inputStream == null)\n    throw new NullPointerException(\"invalid input stream: null is not allowed\");\n\n  final int PUSHBACK_BUFFER_SIZE = 4; // sufficient to hold the largest known BOM\n\n  in = new PushbackInputStream(inputStream, PUSHBACK_BUFFER_SIZE);\n\n  final byte[] bomBytes = new byte[PUSHBACK_BUFFER_SIZE];\n  final int read = in.read(bomBytes);\n\n  switch (read)\n  {\n    case 4:\n      if ((bomBytes[0] == (byte)0xFF) &&\n          (bomBytes[1] == (byte)0xFE) &&\n          (bomBytes[2] == (byte)0x00) &&\n          (bomBytes[3] == (byte)0x00))\n      {\n        this.bom = BOM.UTF_32_LE;\n        break;\n      }\n      else if ((bomBytes[0] == (byte)0x00) &&\n               (bomBytes[1] == (byte)0x00) &&\n               (bomBytes[2] == (byte)0xFE) &&\n               (bomBytes[3] == (byte)0xFF))\n      {\n        this.bom = BOM.UTF_32_BE;\n        break;\n      }\n\n    case 3:\n      if ((bomBytes[0] == (byte)0xEF) &&\n          (bomBytes[1] == (byte)0xBB) &&\n          (bomBytes[2] == (byte)0xBF))\n      {\n        this.bom = BOM.UTF_8;\n        break;\n      }\n\n    case 2:\n      if ((bomBytes[0] == (byte)0xFF) &&\n          (bomBytes[1] == (byte)0xFE))\n      {\n        this.bom = BOM.UTF_16_LE;\n        break;\n      }\n      else if ((bomBytes[0] == (byte)0xFE) &&\n               (bomBytes[1] == (byte)0xFF))\n      {\n        this.bom = BOM.UTF_16_BE;\n        break;\n      }\n\n    default:\n      this.bom = BOM.NONE;\n      break;\n  }\n\n  if (read > 0)\n    in.unread(bomBytes, 0, read);\n}",
  "explanation": "code_hardening: Added a clear null check for the InputStream, marked parameters and locals as final where applicable, and documented the pushback buffer size assumption via a local constant.\nresolve_compilation_errors: Renamed the constructor to BOMStripperInputStream to align with the existing class name and ensured assignments to the already-declared fields in and bom compile correctly.\nexception_handling: Preserved the original NullPointerException and IOException behavior exactly, without introducing new checked or unchecked exceptions.\nlogic_customization: Kept the BOM detection switch logic, fall-through behavior, and pushback (no stripping) semantics unchanged from the original snippet.\nrefactoring: Improved readability by renaming local variables and replacing the magic number 4 with a named local constant, while keeping behavior identical.\nmisc: Updated comments to reflect the BOMStripperInputStream naming and maintained formatting consistent with the surrounding project style. New custom API calls: none."
}