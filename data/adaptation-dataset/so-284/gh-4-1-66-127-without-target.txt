package com.googlecode.jslint4java;

import java.io.IOException;
import java.io.InputStream;
import java.io.PushbackInputStream;


public class UnicodeBomInputStream extends InputStream {

    public static enum BOM {
        NONE(new byte[] {}, "NONE"),
        
        UTF_8(new byte[] { (byte) 0xEF, (byte) 0xBB, (byte) 0xBF }, "UTF-8"),
        
        UTF_16_LE(new byte[] { (byte) 0xFF, (byte) 0xFE }, "UTF-16 little-endian"),
        
        UTF_16_BE(new byte[] { (byte) 0xFE, (byte) 0xFF }, "UTF-16 big-endian"),
        
        UTF_32_LE(new byte[] { (byte) 0xFF, (byte) 0xFE, (byte) 0x00, (byte) 0x00 },
                "UTF-32 little-endian"),
        
        UTF_32_BE(new byte[] { (byte) 0x00, (byte) 0x00, (byte) 0xFE, (byte) 0xFF },
                "UTF-32 big-endian");

        private BOM(byte[] bytes, String description) {
            this.bytes = bytes;
            this.description = description;
        }

        private final byte[] bytes;
        private final String description;

        public byte[] getBytes() {
            final byte[] result = new byte[bytes.length];
            System.arraycopy(bytes, 0, result, 0, bytes.length);
            return result;
        }

        public String getDescription() {
            return description;
        }

        @Override
        public String toString() {
            return description;
        }
    }

        // TODO


    
    public final BOM getBOM() {
        return bom;
    }

    
    public final synchronized UnicodeBomInputStream skipBOM() throws IOException {
        if (!skipped) {
            skip(bom.bytes.length);
            skipped = true;
        }
        return this;
    }

    
    @Override
    public int read() throws IOException {
        return in.read();
    }

    
    @Override
    public int read(final byte b[]) throws IOException, NullPointerException {
        return in.read(b, 0, b.length);
    }

    
    @Override
    public int read(final byte b[], final int off, final int len) throws IOException,
            NullPointerException {
        return in.read(b, off, len);
    }

    
    @Override
    public long skip(final long n) throws IOException {
        return in.skip(n);
    }

    
    @Override
    public int available() throws IOException {
        return in.available();
    }

    
    @Override
    public void close() throws IOException {
        in.close();
    }

    
    @Override
    public synchronized void mark(final int readlimit) {
        in.mark(readlimit);
    }

    
    @Override
    public synchronized void reset() throws IOException {
        in.reset();
    }

    
    @Override
    public boolean markSupported() {
        return in.markSupported();
    }

    private final PushbackInputStream in;
    private final BOM bom;
    private boolean skipped = false;

}
