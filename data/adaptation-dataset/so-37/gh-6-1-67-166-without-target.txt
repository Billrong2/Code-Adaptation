package com.prezi.logbox.utils;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class FileUtils {

    private static Pattern baseNamePattern = null;

    public static String baseName(String fileName) throws Exception {
        if ( baseNamePattern == null){
            baseNamePattern = Pattern.compile(".*/([^\\./]+)((\\.)([^\\./]+))?");
        }

        Matcher m = baseNamePattern.matcher(fileName);
        if (!m.matches()){
            throw new Exception(String.format("Can't calculate basename for file: %s, pattern: %s", fileName, baseNamePattern));
        }
        
        return m.group(1);
    }


    private static Pattern protocolPattern = null;

    public static Protocol protocolFromURI(String URI) throws Exception {
        if ( protocolPattern == null){
            protocolPattern = Pattern.compile("([^:]+)://.*");
        }

        Matcher m = protocolPattern.matcher(URI);
        if (!m.matches()){
            return null;
        }

        String protocolStr = m.group(1);
        if (protocolStr.equals("s3") || protocolStr.equals("s3n")){
            return Protocol.S3;
        }
        else if (protocolStr.equals("hdfs")){
            return Protocol.HDFS;
        }
        else if (protocolStr.equals("file")){
            return Protocol.LOCAL_FILE;
        }
        else {
            throw new Exception(String.format("Unknown protocol: %s", protocolStr));
        }

    }

        // TODO

}

