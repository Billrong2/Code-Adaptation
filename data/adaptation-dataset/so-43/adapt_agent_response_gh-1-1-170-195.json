{
  "code": "/**\n     * Create a Windows registry key.\n     *\n     * @param hkey registry root, one of {@link #HKEY_CURRENT_USER} or {@link #HKEY_LOCAL_MACHINE}\n     * @param key  registry key path to create\n     * @throws IllegalArgumentException      if hkey is invalid, key is null/empty, or creation fails (includes rc and key)\n     * @throws IllegalAccessException        if the underlying registry call cannot be accessed\n     * @throws InvocationTargetException     if the underlying registry call fails\n     */\n    public static void createKey(int hkey, String key)\n            throws IllegalArgumentException, IllegalAccessException, InvocationTargetException {\n        if (key == null || key.trim().isEmpty()) {\n            throw new IllegalArgumentException(\"key=\" + key);\n        }\n\n        final Preferences root;\n        if (hkey == HKEY_LOCAL_MACHINE) {\n            root = systemRoot;\n        } else if (hkey == HKEY_CURRENT_USER) {\n            root = userRoot;\n        } else {\n            throw new IllegalArgumentException(\"hkey=\" + hkey);\n        }\n\n        int[] handles = null;\n        try {\n            handles = createKey(root, hkey, key);\n            final int rc = (handles != null && handles.length > 1) ? handles[1] : -1;\n            if (rc != REG_SUCCESS) {\n                throw new IllegalArgumentException(\"rc=\" + rc + \"  key=\" + key);\n            }\n        } finally {\n            if (handles != null && handles.length > 0) {\n                try {\n                    regCloseKey.invoke(root, handles[0]);\n                } catch (Exception e) {\n                    // ignore close failures\n                }\n            }\n        }\n    }",
  "explanation": "code_hardening: Validated the key parameter for null/empty, selected the registry root safely, used final locals where appropriate, and ensured the registry handle is always closed via a finally block even on failure.\nresolve_compilation_errors: Removed any dependency on Preferences/value parameters in the public API, avoided toCstr and boxing in this function, and relied on the existing private createKey(Preferences,int,String) and regCloseKey methods available in the class.\nexception_handling: Replaced null-return behavior with IllegalArgumentException for invalid hkey and non-success return codes, including rc and key in the message; preserved reflective exceptions in the throws list.\nlogic_customization: Changed behavior to create a registry key, internally selected systemRoot or userRoot based on hkey, rejected other hkeys, invoked the createKey operation, and closed the returned handle after creation.\nrefactoring: Introduced a clearly named public static createKey method with a simplified signature (hkey, key) and removed any read/value-related logic.\nmisc: Added JavaDoc describing purpose, parameters, and exceptions; formatting aligns with existing style. New custom API calls used: none (relies on existing private createKey and regCloseKey)."
}