{
  "code": "public static String encode(final String s, final String encoding) throws UnsupportedEncodingException {\n        if (s == null) {\n            throw new IllegalArgumentException(\"Input string must not be null\");\n        }\n        if (encoding == null) {\n            throw new IllegalArgumentException(\"Encoding must not be null\");\n        }\n\n        final byte[] bytes = s.getBytes(encoding);\n        final StringBuilder sb = new StringBuilder(bytes.length << 1);\n        final char[] digits = {'0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'};\n        // RFC 5987 attr-char whitelist (must remain sorted for binarySearch)\n        final byte[] attrChar = {\n            '!','#','$','&','+','-','.','0','1','2','3','4','5','6','7','8','9',\n            'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z',\n            '^','_','`','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','|','~'\n        };\n\n        for (final byte b : bytes) {\n            if (Arrays.binarySearch(attrChar, b) >= 0) {\n                sb.append((char) b);\n            } else {\n                sb.append('%');\n                sb.append(digits[(b >>> 4) & 0x0f]);\n                sb.append(digits[b & 0x0f]);\n            }\n        }\n        return sb.toString();\n    }",
  "explanation": "code_hardening: Added null checks for both the input string and encoding and fail fast with IllegalArgumentException; kept locals final where appropriate.\nresolve_compilation_errors: Implemented the overloaded encode(String, String) expected by the existing encode(String) delegator; relied on existing imports (Arrays, UnsupportedEncodingException) already present in the file.\nexception_handling: Preserved the throws UnsupportedEncodingException contract by using String.getBytes(String) so callers have consistent checked-exception behavior.\nlogic_customization: Replaced hardcoded UTF-8 with a caller-supplied encoding parameter; changed percent-encoding hex digits to lowercase; preserved the RFC 5987 attr-char whitelist and only percent-encoded non-whitelisted bytes.\nrefactoring: Renamed locals for clarity (e.g., bytes, attrChar), switched to an enhanced for-loop, and simplified length handling without semantic changes.\nmisc: Minor formatting and inline comment clarifying the whitelist requirement; no new custom API calls introduced."
}