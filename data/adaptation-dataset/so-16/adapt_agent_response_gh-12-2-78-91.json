{
  "code": "public void process(final HttpRequest request, final HttpContext context) throws HttpException, IOException {\n    if (context == null) {\n        return;\n    }\n    final HttpClientContext clientContext = HttpClientContext.adapt(context);\n    final AuthState authState = clientContext.getTargetAuthState();\n    if (authState == null) {\n        return;\n    }\n\n    // Only initialize authentication state when no scheme has been set yet\n    if (authState.getAuthScheme() == null) {\n        final CredentialsProvider credsProvider = clientContext.getCredentialsProvider();\n        final HttpHost targetHost = clientContext.getTargetHost();\n        if (credsProvider == null || targetHost == null) {\n            return;\n        }\n\n        final int port = targetHost.getPort() >= 0 ? targetHost.getPort() : AuthScope.ANY_PORT;\n        final Credentials creds = credsProvider.getCredentials(new AuthScope(targetHost.getHostName(), port));\n        if (creds == null) {\n            throw new HttpException(\"No credentials available for target host\");\n        }\n\n        // Always initialize using the configured scheme and resolved credentials\n        authState.update(authScheme, creds);\n    }\n}",
  "explanation": "code_hardening: Added null checks for HttpContext, AuthState, CredentialsProvider, and HttpHost; preserved final parameters; guarded against undefined ports by falling back to AuthScope.ANY_PORT.\nresolve_compilation_errors: Replaced deprecated ClientContext/ExecutionContext attribute access with HttpClientContext.adapt(context) and its typed accessors; relied on AuthState.update(AuthScheme, Credentials) available in newer HttpClient APIs; no additional helpers introduced.\nexception_handling: Updated the HttpException message to the new required wording when credentials cannot be resolved; no new checked exceptions were introduced.\nlogic_customization: Removed all reliance on a context-provided \"preemptive-auth\" attribute; always resolved credentials for the target host when no auth scheme is set; directly used the interceptorâ€™s configured AuthScheme; preserved the trigger condition authState.getAuthScheme() == null.\nrefactoring: Consolidated authentication state initialization into a single authState.update(authScheme, creds) call and simplified variable usage via HttpClientContext accessors.\nmisc: Updated inline comments to reflect the new behavior without context-provided preemptive schemes; no new custom API calls beyond HttpClientContext methods (org.apache.http.client.protocol.HttpClientContext#adapt, #getTargetAuthState, #getCredentialsProvider, #getTargetHost)."
}