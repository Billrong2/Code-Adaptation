{
  "code": "protected final void lockOrientation() {\n    if (this.activity == null) {\n        return;\n    }\n\n    // Always apply the cached orientation lock; compute it once if unset\n    if (this.orientationLock == android.content.pm.ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED) {\n        android.view.WindowManager windowManager = this.activity.getWindowManager();\n        if (windowManager != null) {\n            android.view.Display display = windowManager.getDefaultDisplay();\n            if (display != null) {\n                int rotation = display.getRotation();\n                int currentOrientation = this.activity.getResources().getConfiguration().orientation;\n\n                int computedOrientation = android.content.pm.ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED;\n\n                if (currentOrientation == android.content.res.Configuration.ORIENTATION_LANDSCAPE) {\n                    if (rotation == android.view.Surface.ROTATION_0 || rotation == android.view.Surface.ROTATION_90) {\n                        computedOrientation = android.content.pm.ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE;\n                    } else {\n                        computedOrientation = android.content.pm.ActivityInfo.SCREEN_ORIENTATION_REVERSE_LANDSCAPE;\n                    }\n                } else if (currentOrientation == android.content.res.Configuration.ORIENTATION_PORTRAIT) {\n                    if (rotation == android.view.Surface.ROTATION_0 || rotation == android.view.Surface.ROTATION_270) {\n                        computedOrientation = android.content.pm.ActivityInfo.SCREEN_ORIENTATION_PORTRAIT;\n                    } else {\n                        computedOrientation = android.content.pm.ActivityInfo.SCREEN_ORIENTATION_REVERSE_PORTRAIT;\n                    }\n                }\n\n                // Fallback safety: only store a valid computed orientation\n                if (computedOrientation != android.content.pm.ActivityInfo.SCREEN_ORIENTATION_UNSPECIFIED) {\n                    this.orientationLock = computedOrientation;\n                }\n            }\n        }\n    }\n\n    // Ensure a persistent orientation lock across invocations\n    this.activity.setRequestedOrientation(this.orientationLock);\n}",
  "explanation": "code_hardening: Added null checks for the Activity, WindowManager, and Display; ensured a safe fallback by only updating orientationLock when a valid orientation is computed and always calling setRequestedOrientation with the cached value.\nresolve_compilation_errors: Converted the static utility into a protected instance method using the existing Activity field; relied on the existing orientationLock field initialized to SCREEN_ORIENTATION_UNSPECIFIED; used fully qualified class names where imports are not shown.\nexception_handling: none.\nlogic_customization: Cached the computed orientation in orientationLock and computed it only once when unset; replaced the switch statement with equivalent if/else checks while preserving the original mapping; obtained the Display via activity.getWindowManager().getDefaultDisplay(); always applied setRequestedOrientation using the cached orientationLock.\nrefactoring: Moved orientation state from local variables to the instance field orientationLock; simplified control flow by removing redundant temporaries; adjusted visibility and made the method final to enforce consistent behavior.\nmisc: Added brief inline comments to clarify cached-orientation behavior; no new custom API calls beyond platform methods already available (android.app.Activity#getWindowManager, android.view.WindowManager#getDefaultDisplay)."
}